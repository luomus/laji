<ng-container *ngIf="activeTemplateIdx == null else templateView">
  <h2>{{ 'validation.templates' | translate }}</h2>
  <p>{{ (hasInitialTemplates ? 'validation.templates.description2' : 'validation.templates.description') | translate }}</p>
  <laji-letter-templates
    [templates]="templates"
    [confirmedTemplates]="confirmedTemplates"
    [spectrogramConfig]="spectrogramConfig"
    [audioIdMap]="audioIdMap"
    (templateClick)="onTemplateClick($event)"
  ></laji-letter-templates>
  <div class="clearfix mt-3">
    <button
      *ngIf="hasInitialTemplates"
      class="btn btn-primary"
      [disabled]="saving"
      (click)="confirmAllTemplates()"
    >
      {{ 'validation.templates.confirmAll' | translate }}
    </button>
    <div class="pull-right">
      <button
        class="btn btn-default"
        [disabled]="saving"
        (click)="cancel.emit()"
      >
        {{ 'validation.templates.cancel' | translate }}
      </button>
      <button
        class="btn btn-success ml-3"
        [disabled]="saving"
        (click)="saveTemplates()"
      >
        {{ 'validation.templates.saveAndReturn' | translate }}
      </button>
    </div>
  </div>
  <hr>
  <p>{{ 'validation.templates.candidates.description' | translate }}</p>
  <div class="text-center mb-3">
    <button
      class="btn btn-default"
      (click)="setShowCandidates(!showCandidates)"
    >
      {{ 'validation.templates.candidates.' + (showCandidates ? 'hide' : 'show') | translate }}
      <span class="fa" [ngClass]="{ 'fa-angle-up': showCandidates, 'fa-angle-down': !showCandidates }"></span>
    </button>
  </div>
  <laji-letter-candidates
    *ngIf="candidatesLoaded" [hidden]="!showCandidates"
    [data]="data"
    [templates]="templates"
    [spectrogramConfig]="spectrogramConfig"
    (audioClick)="onAudioClick($event)"
    (candidateClick)="onCandidateClick($event)"
  ></laji-letter-candidates>
</ng-container>

<ng-template #templateView>
  <laji-letter-template
    [audio]="activeAudio"
    [template]="activeTemplate"
    [templateIdx]="activeTemplateIdx"
    [isNew]="activeTemplateIsNew"
    [focusTime]="focusTime"
    [spectrogramConfig]="spectrogramConfig"
    (confirm)="onTemplateConfirm($event)"
    (cancel)="onTemplateCancel()"
    (remove)="onTemplateRemove()"
  ></laji-letter-template>
</ng-template>
