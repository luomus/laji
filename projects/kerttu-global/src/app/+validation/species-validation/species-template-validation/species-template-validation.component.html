<ng-container *ngIf="activeTemplateIdx == null else templateView">
  <div id="species-template-validation-header">
    <h1 *ngIf="species" class="d-inline-block">
      {{ species.commonName }} - <i>{{ species.scientificName }}</i>
    </h1>
    <div class="gray" *ngIf="subSpecies.length > 0">
      {{ 'validation.includingSubspecies' | translate }}:
      <ng-container *ngFor="let sub of subSpecies">
        <br>
        {{ sub.commonName }} - <i>{{ sub.scientificName }}</i>
      </ng-container>
    </div>
  </div>
  <h2 class="mt-0">{{ 'validation.templates' | translate }}</h2>
  <p>{{ ('validation.description' + (historyView ? '.oldVersion' : (hasInitialTemplates ? '.confirm' : ''))) | translate }}</p>
  <laji-letter-templates
    [templates]="templates"
    [confirmedTemplates]="confirmedTemplates"
    [spectrogramConfig]="spectrogramConfig"
    [audioIdMap]="audioIdMap"
    [historyView]="historyView"
    (templateClick)="onTemplateClick($event)"
  ></laji-letter-templates>
  <div class="clearfix mt-3">
    <label class="selectable" *ngIf="!hasInitialTemplates && !historyView">
      <input type="checkbox" [disabled]="saving" [(ngModel)]="creatingAllIsNotPossible">
      {{ 'validation.saveAsNotPossible' | translate }}
    </label>
    <button
      *ngIf="hasInitialTemplates && !historyView"
      class="btn btn-primary"
      [disabled]="saving"
      (click)="confirmAllTemplates()"
    >
      {{ 'validation.confirmAll' | translate }}
    </button>
    <div class="pull-right">
      <button
        class="btn btn-default"
        [disabled]="saving"
        (click)="cancel.emit()"
      >
        {{ 'validation.cancel' | translate }}
      </button>
      <button
        class="btn btn-success ml-3"
        [disabled]="saving || historyView"
        (click)="saveTemplates()"
      >
        {{ 'validation.saveAndReturn' | translate }}
      </button>
    </div>
  </div>
  <hr>
  <p>{{ ('validation.candidates.description' + (historyView ? '.oldVersion' : '')) | translate }}</p>
  <div class="text-center mb-3">
    <button
      class="btn btn-default"
      (click)="setShowCandidates(!showCandidates)"
    >
      {{ 'validation.candidates.' + (showCandidates ? 'hide' : 'show') | translate }}
      <span class="fa" [ngClass]="{ 'fa-angle-up': showCandidates, 'fa-angle-down': !showCandidates }"></span>
    </button>
  </div>
  <laji-letter-candidates
    *ngIf="showCandidates"
    [data]="data"
    [templates]="templates"
    [spectrogramConfig]="spectrogramConfig"
    (audioClick)="onAudioClick($event)"
    (candidateClick)="onCandidateClick($event)"
  ></laji-letter-candidates>
</ng-container>

<ng-template #templateView>
  <h1 *ngIf="activeAudio" class="d-inline-block">
    {{ activeAudio.species.commonName }} - <i>{{ activeAudio.species.scientificName }}</i>
  </h1>
  <laji-letter-template
    [audio]="activeAudio"
    [template]="activeTemplate"
    [templateIdx]="activeTemplateIdx"
    [isNew]="activeTemplateIsNew"
    [focusTime]="focusTime"
    [spectrogramConfig]="spectrogramConfig"
    [historyView]="historyView"
    (confirm)="onTemplateConfirm($event)"
    (cancel)="onTemplateCancel()"
    (remove)="onTemplateRemove()"
    (comment)="onComment($event)"
  ></laji-letter-template>
</ng-template>
