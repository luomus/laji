<h3>{{ 'validation.templates.audio' | translate }}</h3>
<p *ngIf="!historyView">{{ 'validation.templates.audio.description' | translate }}</p>
<div class="audio-viewer-with-settings">
  <laji-audio-viewer-settings
    [(zoomed)]="zoomFrequency"
    [(xRangePadding)]="timePadding"
    [defaultZoomed]="defaultZoomFrequency"
    [defaultXRangePadding]="defaultTimePadding"
    [displayInline]="true"
  ></laji-audio-viewer-settings>
  <laji-audio-viewer
    [audio]="audio"
    [spectrogramConfig]="spectrogramConfig"
    [mode]="audioViewerMode"
    [focusArea]="template ? template.area : {'xRange': [focusTime, focusTime]}"
    [spectrogramHeight]="150"
    [showZoomControl]="true"
    [zoomFrequency]="template ? zoomFrequency : false"
    [zoomTime]="true"
    [timePaddingOnZoom]="template ? timePadding : 60"
    (drawEnd)="onDrawEnd($event)"
  ></laji-audio-viewer>
</div>
<div class="mt-3">
  <div>
    <button
      class="btn btn-primary"
      [disabled]="historyView"
      [ngClass]="{'active': audioViewerMode === 'draw'}"
      (click)="toggleDrawMode()"
    >
      {{ ('validation.templates.' + (template ? 'reframe' : 'frame')) | translate }}
    </button>
  </div>
</div>

<div class="row mt-5">
  <div class="col-sm-4">
    <h3 class="d-inline-block">{{ ('validation.templates.' + (historyView ? 'history' : (isNew ? 'new' : 'current'))) | translate }} T{{ templateIdx + 1 }}</h3>
    <p *ngIf="!historyView">{{ 'validation.templates.template.description' | translate }}</p>
  </div>
  <div class="col-sm-8">
    <laji-audio-viewer
      *ngIf="template"
      [audio]="audio"
      [spectrogramConfig]="spectrogramConfig"
      [focusArea]="template.area"
      [zoomTime]="true"
      [timePaddingOnZoom]="0.5"
      [zoomFrequency]="true"
      [showControls]="false"
      [spectrogramHeight]="150"
      [showAxisLabels]="false"
      [mode]="audioViewerMode"
      (drawEnd)="onDrawEnd($event)"
    ></laji-audio-viewer>
  </div>
</div>
<div class="mt-5" *ngIf="template?.comment">
  <h3>{{ 'validation.templates.template.comment' | translate }}</h3>
  <div class="panel panel-default">
    <div class="panel-body">
      <p>
        {{ template.comment.created | amDateFormat: 'DD.MM.YYYY HH:mm:ss' }}
        <span [ngClass]="{
          'text-danger': template.comment.type === commentTypeEnum.replace,
          'text-warning': template.comment.type === commentTypeEnum.reframe
        }" class="text-danger">
          {{ 'validation.templates.template.' + (template.comment.type === commentTypeEnum.replace ? 'removed' : 'reframed') | translate }}
        </span>
      </p>
      <p>
        {{ template.comment.userId | usersÂ }}:
        <br>
        {{ template.comment.comment }}
      </p>
    </div>
  </div>
</div>
<div class="mt-3 mb-5">
  <div>
    <button
      [disabled]="!template || historyView"
      class="btn btn-success mr-3"
      (click)="onConfirm()"
    >
      {{ 'validation.templates.confirm' | translate }}
    </button>
    <button
      class="btn btn-default mr-3"
      (click)="cancel.emit()"
    >
      {{ 'validation.templates.cancel' | translate }}
    </button>
    <button
      [disabled]="!template || isNew || historyView"
      class="btn btn-danger"
      (click)="onRemove()"
    >
      {{ 'validation.templates.remove' | translate }}
    </button>
  </div>
</div>

<ng-template #commentModal>
  <div class="modal-content">
    <div class="modal-body">
      <p>{{ 'validation.templates.confirmAndComment' | translate }}</p>
      <textarea id="comment" class="form-control" [(ngModel)]="commentText" name="comment" rows="7"></textarea>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" (click)="hideCommentModal()">
        <span>{{ 'validation.templates.cancel' | translate }}</span>
      </button>
      <button type="button" class="btn btn-success" [disabled]="!commentText" (click)="this.confirmComment()">
        <span>{{ 'validation.templates.confirm' | translate }}</span>
      </button>
    </div>
  </div><!-- /.modal-content -->
</ng-template>
