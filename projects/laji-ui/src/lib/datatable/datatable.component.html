<table>
  <tr>
    <th
      *ngFor="let colIdx of selectedColumns; let idx = index"
      draggable="true"
      (dragstart)="onTableHeaderDragStart($event, idx)"
      (dragend)="onTableHeaderDragEnd($event)"
      (dragover)="onTableHeaderDragOver($event)"
      (drop)="onTableHeaderDrop($event)"
      #headerRef
    >
      <span class="header-contents">
        {{ columns[colIdx].title }} 
        <div class="d-flex flex-row flex-nowrap">
          <button
            *ngIf="columns[colIdx].sortable === undefined || columns[colIdx].sortable"
            class="sort-btn mr-2"
            [ngClass]="{
              'sort-btn mr-2': true,
              'sorted': colSortType(colIdx) !== 'NONE'
            }"
            (click)="onToggleSort(colIdx)">
            {{ getSortBtnChar(colIdx) }}
          </button>
          <button class="unselect-col-btn" (click)="onUnselectColumn(colIdx)">x</button>
        </div>
      </span>
      <span class="col-separator" (mousedown)="onResizeMouseDown($event)"></span>
    </th>
    <th *ngIf="columns.length > selectedColumns.length">
      <input list="unselected-columns" name="add-column" placeholder="Add column..." (input)="onAddColumn($event)" />
      <datalist id="unselected-columns">
        <option *ngFor="let colIdx of unselectedColumns" [value]="colIdx">
          {{ columns[colIdx].title }}
        </option>
      </datalist>
    </th>
  </tr>
  <ng-container *ngIf="!loading else rowGhosts">
    <tr *ngFor="let row of rows">
      <td *ngFor="let colIdx of selectedColumns" #rowRef> {{ getNestedValue(row, columns[colIdx].prop) }}</td>
    </tr>
  </ng-container>
  <tr></tr>
</table>
<ul *ngIf="totalPages > 1" class="paginator">
  <ng-container *ngIf="totalPages <= 5; else truncatedPaginator">
    <li *ngFor="let i of [].constructor(totalPages); let idx = index" (click)="onChangePage(idx)">
      {{ idx }}
    </li>
  </ng-container>
</ul>

<ng-template #truncatedPaginator>
    <li *ngFor="let i of [].constructor(3); let idx = index" (click)="onChangePage(idx)">
      {{ idx + 1 }}
    </li>
    <li class="three-dots">...</li>
    <li (click)="onChangePage(totalPages - 1)">{{ totalPages }}</li>
</ng-template>

<ng-template #rowGhosts>
  <tr *ngFor="let i of [].constructor(ghostCount); let idx = index">
    <td *ngFor="let _ of selectedColumns" class="cell-ghost"><span></span></td>
  </tr>
</ng-template>
