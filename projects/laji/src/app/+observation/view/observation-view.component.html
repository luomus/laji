@if (vm$ | async; as vm) {
  <lu-sidebar [position]="'right'" [staticWidth]="300" [menuTitle]="'observation.form.menuTitle' | translate" [luFillHeight]="{}" [displayNavHeader]="true">
    <main>
      <laji-technical-news></laji-technical-news>
      <laji-observation-result
        [resultBase]="formType"
        [visible]="visible"
        [skipUrlParameters]="skipUrlParameters"
        [basePath]="basePath"
        [lang]="translate.getCurrentLang()"
        [loadingUnits]="vm.loadingUnits"
        [loadingTaxa]="vm.loadingTaxa"
        [lgScreen]="vm.lgScreen"
        [speciesCount]="vm.countTaxa"
        [unitCount]="vm.countUnit"
        [active]="activeTab"
        [activeQuery]="vm.activeQuery"
        [tmpQuery]="vm.tmpQuery"
        [listSettings]="settingsList$ | async"
        (listSettingsChange)="onListSettingsChange($event)"
        (activeQueryChange)="updateActiveQuery($event)"
        (tmpQueryChange)="updateTmpQuery($event, true)"
      ></laji-observation-result>
    </main>
    <div class="nav-header">
      <button class="btn btn-primary observation-search-btn" (click)="updateActiveQuery(vm.tmpQuery)" [disabled]="!vm.tmpQueryHasChanges">
        {{ 'observation.search' | translate }}
      </button>
      <laji-observation-active
        [skip]="formType === 'sample' ? skipUrlParameters : []"
        [query]="vm.tmpQuery"
        (queryChange)="updateActiveQuery($event)"
        [queryType]="'observation'"
      ></laji-observation-active>
    </div>
    <nav>
      @switch (formType) {
        @case ('sample') {
          <laji-form-sample
            [query]="vm.tmpQuery"
            [invasiveStatuses]="invasiveStatuses"
            (mapDraw)="draw($event)"
            (queryChange)="updateTmpQuery($event)"
          ></laji-form-sample>
        }
        @default {
          <laji-observation-form
            [query]="vm.tmpQuery"
            [invasiveStatuses]="invasiveStatuses"
            (mapDraw)="draw($event)"
            (queryChange)="updateTmpQuery($event)"
          ></laji-observation-form>
        }
      }
    </nav>
  </lu-sidebar>
}
