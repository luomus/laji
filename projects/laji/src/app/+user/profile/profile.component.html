<div class="container container-relative">
  <h1>{{ 'navigation.user.profile' | translate }}</h1>
  <laji-spinner [spinning]="loading" [hideContentWhileLoading]="true">
    @if (currentProfile && userProfile) {
      @if (!currentProfile.userID) {
        <div class="row">
          {{ 'profile.missing' | translate }}
        </div>
      }
      @if (currentProfile.userID || isCurrentUser) {
        <div class="row">
          <div class="col-md-8 col-xs-12 margin-bottom-5">
            <h3>{{ currentProfile.userID | users }} ({{ userId }})</h3>
            <div class="profile-image">
              @if (currentProfile.image) {
                <img [src]="currentProfile.image" alt="profile image" class="img-rounded">
              }
            </div>
            <ng-container *lajiForTypes="['kerttuGlobal']; exclude: true">
              @if (isCurrentUser) {
                <lu-button
                  [small]="true"
                  class="edit-text mb-4"
                  (click)="toggleEditing()">
                  {{ 'profile.edit' | translate}}
                  <i class="glyphicon glyphicon-cog"></i>
                </lu-button>
              }
              @if (!editing) {
                <div>
                  <p>{{ currentProfile.profileDescription }}</p>
                  @if (currentProfile.personalCollectionIdentifier) {
                    <p>
                      {{ 'MA.personalCollectionIdentifier' | label }}:<br>{{ currentProfile.personalCollectionIdentifier }}
                    </p>
                  }
                </div>
              }
              @if (editing) {
                <div class="profile-edit">
                  <p>{{ 'profile.info.intro' | translate }}</p>
                  <div class="profile-edit-row">
                    {{ 'profile.image' | translate }}
                    <input class="form-control" placeholder="{{'profile.imagePlaceholder' | translate}}" [(ngModel)]="currentProfile.image">
                  </div>
                  <div class="profile-edit-row">
                    {{ 'profile.description' | translate }}
                    <textarea class="form-control" [(ngModel)]="currentProfile.profileDescription"></textarea>
                  </div>
                  <div class="profile-edit-row">
                    {{ 'MA.personalCollectionIdentifier' | label }}<laji-info [placement]="'right'">{{ 'profile.info.personalCollectionIdentifier' | translate }}</laji-info>
                    <input class="form-control" [(ngModel)]="currentProfile.personalCollectionIdentifier">
                  </div>
                  <h4>{{ 'profile.defaultMediaMetadata.title' | translate }}</h4>
                  <div class="profile-edit-row">
                    {{ 'MM.capturerVerbatim' | label }}<laji-info [placement]="'right'">{{ 'profile.info.capturerVerbatim' | translate }}</laji-info>
                    <input class="form-control" [(ngModel)]="currentProfile.settings!.defaultMediaMetadata!.capturerVerbatim">
                  </div>
                  <div class="profile-edit-row">
                    {{ 'MZ.intellectualOwner' | label }}<laji-info [placement]="'right'">{{ 'profile.info.intellectualOwner' | translate }}</laji-info>
                    <input class="form-control" [(ngModel)]="currentProfile.settings!.defaultMediaMetadata!.intellectualOwner">
                  </div>
                  <div class="profile-edit-row">
                    {{ 'MZ.intellectualRights' | label }}<laji-info [placement]="'right'">{{ 'profile.info.intellectualRights' | translate }}</laji-info>
                    <select class="form-control" [(ngModel)]="currentProfile.settings!.defaultMediaMetadata!.intellectualRights">
                      @for (c of intellectualRightsArray; track c) {
                        <option [ngValue]="c">{{ c | label }}</option>
                      }
                    </select>
                  </div>
                  <div class="profile-edit-row">
                    <lu-button (click)="saveProfile()" role="primary">{{ 'profile.save' | translate }}</lu-button>
                  </div>
                </div>
              }
            </ng-container>
            <div class="mt-6" *lajiLoggedIn="true">
              @if ((getCurrentUser() | async)!.id === userId) {
                <div class="form-group">
                  <div class="col-sm-12 well">
                    <p>{{ 'selfUrl.introStart' | translate }}</p>
                    <a [href]="personSelfUrl | safe:'url'" class="btn btn-success self-link">{{ 'profile.accountSettings'|translate }}</a>
                    <p>{{ 'selfUrl.introEnd' | translate }}</p>
                  </div>
                </div>
              }
            </div>
          </div>
          <div class="col-md-4 col-xs-12" *lajiLoggedIn="true">
            <div class="form-group" *lajiForTypes="['kerttuGlobal']; exclude: true">
              <div class="col-sm-12 well">
                <laji-find-person (selectChange)="selectPerson($event)"></laji-find-person>
                <laji-friends [profile]="currentProfile" [usersProfile]="userProfile"></laji-friends>
              </div>
            </div>
          </div>
        </div>
      }
    }
  </laji-spinner>
</div>

