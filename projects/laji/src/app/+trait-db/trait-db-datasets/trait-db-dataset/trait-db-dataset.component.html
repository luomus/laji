<ng-container *ngIf="data$ | async; let data; else loading">
  <ng-container *ngIf="data.dataset !== null; else datasetNotFound">
    <div class="d-flex justify-between mb-4">
      <h2 class="mb-0">{{ data.dataset?.name }}</h2>
      <ng-container *ngIf="data.perms !== undefined; else loading">
        <button *ngIf="data.perms !== null" [routerLink]="['edit']" class="btn btn-default">
          <i class="glyphicon glyphicon-wrench"></i>
          Edit dataset
        </button>
      </ng-container>
    </div>
    <p>{{ data.dataset?.description }}</p>

    <table class="props-table">
      <tr>
        <th scope="row">Citation:</th>
        <td>{{ data.dataset?.citation }}</td>
      </tr>
      <tr>
        <th scope="row">Intellectual owner:</th>
        <td>{{ data.dataset?.intellectualOwner }}</td>
      </tr>
      <tr>
        <th scope="row">Person responsible:</th>
        <td>{{ data.dataset?.personResponsible }}</td>
      </tr>
      <tr>
        <th scope="row">Contact email:</th>
        <td>{{ data.dataset?.contactEmail }}</td>
      </tr>
      <tr *ngIf="data.dataset?.institutionCode">
        <th scope="row">Institution code:</th>
        <td>{{ data.dataset?.institutionCode }}</td>
      </tr>
      <tr>
        <th scope="row">Methods:</th>
        <td>{{ data.dataset?.methods }}</td>
      </tr>
      <tr>
        <th scope="row">Taxonomic coverage:</th>
        <td>{{ data.dataset?.taxonomicCoverage }}</td>
      </tr>
      <tr>
        <th scope="row">Temporal coverage:</th>
        <td>{{ data.dataset?.temporalCoverage }}</td>
      </tr>
      <tr>
        <th scope="row">Geographic coverage:</th>
        <td>{{ data.dataset?.geographicCoverage }}</td>
      </tr>
      <tr>
        <th scope="row">Coverage basis:</th>
        <td>{{ data.dataset?.coverageBasis }}</td>
      </tr>
      <tr *ngIf="data.dataset?.doi">
        <th scope="row">FinBIF DOI:</th>
        <td>{{ data.dataset?.doi }}</td>
      </tr>
      <tr *ngIf="data.dataset?.gbifDoi">
        <th scope="row">GBIF DOI:</th>
        <td>{{ data.dataset?.gbifDoi }}</td>
      </tr>
      <tr>
        <th scope="row">Additional identifiers:</th>
        <td>{{ data.dataset?.additionalIdentifier }}</td>
      </tr>
      <tr>
        <th scope="row">Published:</th>
        <td>{{ data.dataset?.published }}</td>
      </tr>
    </table>

    <ng-container *ngIf="data.perms !== undefined; else loading">
      <ng-container *ngIf="data.perms !== null">
        <h3>Permissions</h3>
        <ul>
          <li *ngFor="let userId of data.perms.userIds">{{ userId }}</li>
        </ul>
        <button class="btn btn-default">Edit permissions</button>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="data.dataset?.published">
      <div class="d-flex justify-between mt-8 mb-4">
        <h3 class="mb-0">Trait data</h3>
        <div *ngIf="data.perms !== undefined; else loading">
          <ng-container *ngIf="data.perms !== null">
            <a [routerLink]="['data-entry']" class="btn btn-default mr-3">
              <i class="glyphicon glyphicon-upload"></i>
              Upload trait data
            </a>
            <a [routerLink]="['data-editor']" class="btn btn-default">
              <i class="glyphicon glyphicon-edit"></i>
              Modify existing trait data
            </a>
          </ng-container>
        </div>
      </div>
      <laji-trait-search [datasetId]="data.dataset?.id"></laji-trait-search>
    </ng-container>
  </ng-container>
</ng-container>

<ng-template #loading>
  <laji-spinner class="d-block m-6"></laji-spinner>
</ng-template>

<ng-template #datasetNotFound>
  The dataset could not be found.
</ng-template>
