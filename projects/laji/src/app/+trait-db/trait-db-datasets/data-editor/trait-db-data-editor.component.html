<h1>Trait data editor</h1>
@if ((tableData$ | async); as tableData) {
  <div>
    <lu-datatable
      [rows]="tableData.rows.controls"
      [columns]="tableData.cols"
    ></lu-datatable>
  </div>
}

<ng-template #stringCell let-row let-col="col" let-rowIdx="rowIdx" let-colIdx="colIdx">
  @if (row.get($any(col).prop); as control) {
    <input class="form-control" [formControl]="control"/>
  }
</ng-template>

<ng-template #numberCell let-row let-col="col" let-rowIdx="rowIdx" let-colIdx="colIdx">
  @if (row.get($any(col).prop); as control) {
    <input type="number" class="form-control" [formControl]="control"/>
  }
</ng-template>

<ng-template #booleanCell let-row let-col="col" let-rowIdx="rowIdx" let-colIdx="colIdx">
  @if (row.get($any(col).prop); as control) {
    <input type="checkbox" [formControl]="control"/>
  }
</ng-template>

<ng-template #enumCell let-row let-col="col" let-rowIdx="rowIdx" let-colIdx="colIdx">
  @if (row.get($any(col).prop); as control) {
    <select class="form-control" [formControl]="control">
      @for (option of col.variants; track option) {
        <option [value]="option">
          {{ option }}
        </option>
      }
    </select>
  }
</ng-template>

<ng-template #editCell let-row let-col="col" let-rowIdx="rowIdx" let-colIdx="colIdx">
  @if ((rowUploadState$ | async); as rowUploadState) {
    <div class="d-flex flex-nowrap">
      <span
        class="status-icon"
      [ngClass]="{
        'glyphicon glyphicon-hourglass info': rowUploadState[rowIdx]?._tag === 'in-progress' || rowUploadState[rowIdx]?._tag === 'deleting',
        'glyphicon glyphicon-ok success': rowUploadState[rowIdx]?._tag === 'complete',
        'glyphicon glyphicon-remove danger': rowUploadState[rowIdx]?._tag === 'error'
      }"
        [luTooltip]="rowUploadState[rowIdx]?._tag === 'error' ? $any(rowUploadState[rowIdx]).msg : null"
      ></span>
      <button
        class="lu-btn btn-default mr-4"
        [class.lu-loading]="rowUploadState[rowIdx]?._tag === 'in-progress'"
        [disabled]="rowUploadState[rowIdx]?._tag === 'in-progress' || rowUploadState[rowIdx]?._tag === 'deleting'"
        (click)="onSubmitRow(row, rowIdx)"
        >
        Submit
      </button>
      <button
        class="lu-btn btn-default"
        [class.lu-loading]="rowUploadState[rowIdx]?._tag === 'deleting'"
        [disabled]="rowUploadState[rowIdx]?._tag === 'in-progress' || rowUploadState[rowIdx]?._tag === 'deleting'"
        (click)="onDeleteRow(row, rowIdx)"
        >
        Delete
      </button>
    </div>
  }
</ng-template>

