@if ((validationState$ | async); as validationState) {
  <div>
    @if (validationState._tag === 'not-started') {
      <div>Loading...</div>
    }
    @if (validationState._tag === 'in-progress') {
      <div>Validating...</div>
    }
    @if (validationState._tag === 'http-error') {
      <div>Http error!</div>
    }
    @if (table$ | async; as table) {
      <lu-datatable
        [rows]="table.rows"
        [columns]="table.cols"
      ></lu-datatable>
    }
    @if (validationState._tag === 'complete' && validationState.result.header?.pass === false && validationState.result.header?.errors) {
      <ul>
        @for (err of objectEntries(validationState.result.header!.errors!); track err) {
          <li>
            Column {{ err[0] }}: {{ err[1] }}
          </li>
        }
      </ul>
    }
    <button
      class="btn btn-default"
      [disabled]="validationState._tag !== 'complete' || (validationState._tag === 'complete' && !validationState.result.pass)"
      (click)="onSubmit()"
      >
      Continue
    </button>
  </div>
}

<ng-template #cellTemplate let-row let-p="prop" let-rowIdx="rowIdx" let-colIdx="colIdx">
  {{ p }} @if ((validationState$ | async); as validationState) {
  @if (validationState._tag === 'complete' && validationState.result.rows?.[rowIdx]?.errors?.[colIdx]) {
    <span class="pill danger" [luTooltip]="validationState.result.rows?.[rowIdx]?.errors?.[colIdx]">x</span>
  }
}
</ng-template>
