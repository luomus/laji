/* tslint:disable */
/**
 * API documentation
 * To use this api you need an access token. To getList the token, send a post request with your email address to api-users resource and one will be send to your. See below for information on how to use this api and if you have any questions you can contact us at helpdesk@laji.fi.  Place refer to [schema.laji.fi](http://schema.laji.fi/) for more information about the used vocabulary
 *
 * OpenAPI spec version: 0.0.1
 *
 *
 * NOTE: TEST This class is auto generated by the swagger code generator program.
 * https://github.com/swagger-api/swagger-codegen.git
 * Do not edit the class manually.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { Observable } from 'rxjs/Observable';
import { PagedResult } from '../model/PagedResult';
import { WarehouseQueryInterface } from '../model/WarehouseQueryInterface';
import { SearchQueryService } from '../../+observation/search-query.service';
import { WarehouseCountResultInterface } from '../model/WarehouseCountResultInterface';
import { HttpClient, HttpResponse } from '@angular/common/http';
import { Util } from '../service/util.service';
import { environment } from '../../../environments/environment';
import { PlatformService } from '../service/platform.service';
import { EMPTY } from 'rxjs';

/* tslint:disable:no-unused-variable member-ordering */

'use strict';

@Injectable({providedIn: 'root'})
export class WarehouseApi {
  public static readonly longTimeout = 10000;
  public subPath:
    '/warehouse/query/sample/' |
    '/warehouse/query/' = '/warehouse/query/';
  protected basePath = environment.apiBase;

  constructor(
    protected http: HttpClient,
    private queryService: SearchQueryService,
    private platformService: PlatformService
  ) {
    this.warehouseQueryAggregateGet = this.warehouseQueryAggregateGet.bind(this);
    this.warehouseQueryStatisticsGet = this.warehouseQueryStatisticsGet.bind(this);
  }

  public static prepareCountQuery(query: WarehouseQueryInterface) {
    return Util.removeFromObject(query, ['selected', 'aggregateBy', 'orderBy', 'page', 'pageSize']);
  }

  public static isEmptyQuery(query: WarehouseQueryInterface = {}) {
    const keys = Object.keys(query);
    for (const key of keys) {
      if (typeof query[key] === 'undefined') {
        continue;
      } else if (key === 'countryId') {
        if (query.countryId.length === 0 || (query.countryId.length === 1 && query.countryId.indexOf('ML.206') > -1)) {
          continue;
        }
        return false;
      } else if (['includeNonValidTaxa', 'cache'].indexOf(key) > -1 || key.charAt(0) === '_') {
        continue;
      }
      return false;
    }
    return true;
  }

  /**
   * Perform aggregation query using given filter and aggregation
   * Aggregates the results of the query based on given \&quot;aggregateBy\&quot; parameter or parameters. Returns count of units, individual count sum and maximum and min and max date.
   * @param query to make to the warehouse
   * @param aggregateBy Define fields to aggregate by. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param orderBy Define order of fields. Defaults to count of units (desc). Give number of the column, first is 1. aggregateBy -fields are first, followed by count of units, individual count sum and maximum and min and max date. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param pageSize Set number of results in one page.
   * @param page Set current page.
   * @param geoJSON returns data as geojson.
   * @param onlyCount return only count in result items (default true).
   * @oaram onlyCount return only counts of items default true
   */
  public warehouseQueryAggregateGetCsv(query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, onlyCount?: boolean): Observable<HttpResponse<any>> {
    const path = this.basePath + this.subPath + 'aggregate';

    let queryParameters = {};

    this.addQueryToQueryParams(this.queryWithMetaData(query, aggregateBy, orderBy, pageSize, page), queryParameters);

    if (onlyCount !== undefined) {
      queryParameters['onlyCount'] = onlyCount
    }
    queryParameters['format'] = 'csv';

    return this.http.get<HttpResponse<any>>(path, {params: queryParameters, observe: 'response'});
  }


  /**
   * Fetch warehouse team member
   * @param id
   * @param extraHttpRequestParams
   */
  public warehouseTeamMemberGet(id: string, extraHttpRequestParams?: any): Observable<any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + `/warehouse/teamMember/${id}`;

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};
    // verify required parameter 'documentId' is not null or undefined
    if (id === null || id === undefined) {
      throw new Error('Required parameter id was null or undefined when calling warehouseTeamMemberGet.');
    }

    return this.http.get(path, {params: queryParameters});
  }

  /**
   * Fetch warehouse team member
   * @param query
   * @param extraHttpRequestParams
   */
  public warehouseTeamMemberFind(query: string, extraHttpRequestParams?: any): Observable<any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + `/warehouse/teamMember`;

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};
    // verify required parameter 'documentId' is not null or undefined
    if (query === null || query === undefined) {
      throw new Error('Required parameter query was null or undefined when calling warehouseTeamMemberFind.');
    }
    queryParameters['q'] = query;

    return this.http.get(path, {params: queryParameters});
  }

  private warehouseQueryGet(target: string, query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, geoJSON?: boolean, onlyCount?: boolean): Observable<PagedResult<any>|any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + `${this.subPath}${target}`;

    let queryParameters = {};

    if (WarehouseApi.isEmptyQuery(query) && typeof query.cache === 'undefined') {
      query = {...query, cache: true};
    }

    this.addQueryToQueryParams(this.queryWithMetaData(query, aggregateBy, orderBy, pageSize, page), queryParameters);

    if (geoJSON !== undefined) {
      queryParameters['geoJSON'] = geoJSON
    }

    if (onlyCount !== undefined) {
      queryParameters['onlyCount'] = onlyCount
    }
    if (target === 'count') {
      queryParameters = WarehouseApi.prepareCountQuery(queryParameters);
    }

    return this.http.get<PagedResult<any>|any>(path, {params: queryParameters});
  }

  /**
   * Perform aggregation query using given filter and aggregation
   * Aggregates the results of the query based on given \&quot;aggregateBy\&quot; parameter or parameters. Returns count of units, individual count sum and maximum and min and max date.
   * @param query to make to the warehouse
   * @param aggregateBy Define fields to aggregate by. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param orderBy Define order of fields. Defaults to count of units (desc). Give number of the column, first is 1. aggregateBy -fields are first, followed by count of units, individual count sum and maximum and min and max date. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param pageSize Set number of results in one page.
   * @param page Set current page.
   * @param geoJSON returns data as geojson.
   * @param onlyCount return only count in result items (default true).
   */
  public warehouseQueryAggregateGet(query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, geoJSON?: boolean, onlyCount?: boolean): Observable<PagedResult<any>|any> {
    return this.warehouseQueryGet('unit/aggregate', query, aggregateBy, orderBy, pageSize, page, geoJSON, onlyCount);
  }

  /**
   * Aggregates based on documents
   *
   */
  public warehouseQueryDocumentAggregateGet(query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, geoJSON?: boolean, onlyCount?: boolean): Observable<PagedResult<any>|any> {
    return this.warehouseQueryGet('document/aggregate', query, aggregateBy, orderBy, pageSize, page, geoJSON, onlyCount);
  }


  /**
   * Aggregates based on annotations
   *
   * @see warehouseQueryAggregateGet
   */
  public warehouseQueryAnnotationAggregateGet(query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, geoJSON?: boolean, onlyCount?: boolean): Observable<PagedResult<any>|any> {
    return this.warehouseQueryGet('annotation/aggregate', query, aggregateBy, orderBy, pageSize, page, geoJSON, onlyCount);
  }

  /**
   * Same as aggregate query, but performs the query on private data
   */
  public warehouseQueryStatisticsGet(query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, geoJSON?: boolean, onlyCount?: boolean): Observable<PagedResult<any>|any> {
    return this.warehouseQueryGet('statistics', query, aggregateBy, orderBy, pageSize, page, geoJSON, onlyCount);
  }

  /**
   * Same as aggragate query, but performs the query on private data
   */
  public warehouseQueryGatheringStatisticsGet(query: WarehouseQueryInterface, aggregateBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, geoJSON?: boolean, onlyCount?: boolean): Observable<PagedResult<any>|any> {
    return this.warehouseQueryGet('gathering/statistics', query, aggregateBy, orderBy, pageSize, page, geoJSON, onlyCount);
  }

  public downloadApprovalRequest(userToken: string, downloadFormat: string, includes: string, query: WarehouseQueryInterface, locale: string, description: string): Observable<string> {
    const path = this.basePath + '/warehouse/private-query/downloadApprovalRequest';

    const queryParameters = {};

    if (userToken === null || userToken === undefined) {
      throw new Error('Required parameter personToken was null or undefined when calling warehouse download.');
    }

    if (downloadFormat === null || downloadFormat === undefined) {
      throw new Error('Required parameter downloadFormat was null or undefined when calling warehouse download.');
    }

    if (includes === null || includes === undefined) {
      throw new Error('Required parameter includes was null or undefined when calling warehouse download.');
    }

    queryParameters['personToken'] = userToken;
    queryParameters['downloadFormat'] = downloadFormat;
    queryParameters['downloadIncludes'] = includes;

    if (locale !== undefined) {
      queryParameters['locale'] = locale;
    }

    if (description !== undefined) {
      queryParameters['description'] = description;
    }

    this.addQueryToQueryParams(query, queryParameters);

    return this.http.post<string>(path, undefined, {params: queryParameters, headers: {timeout: '180000'}});
  }

  public download(userToken: string, downloadFormat: string, includes: string, query: WarehouseQueryInterface, locale: string, downloadType?: string, extraHttpRequestParams?: any): Observable<string> {
    const path = this.basePath + '/warehouse/query/download';

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};

    if (userToken === null || userToken === undefined) {
      throw new Error('Required parameter personToken was null or undefined when calling warehouse download.');
    }

    if (downloadFormat === null || downloadFormat === undefined) {
      throw new Error('Required parameter downloadFormat was null or undefined when calling warehouse download.');
    }

    if (includes === null || includes === undefined) {
      throw new Error('Required parameter includes was null or undefined when calling warehouse download.');
    }

    queryParameters['personToken'] = userToken;
    queryParameters['downloadFormat'] = downloadFormat;
    queryParameters['downloadIncludes'] = includes;

    if (locale !== undefined) {
      queryParameters['locale'] = locale;
    }

    if (downloadType !== undefined) {
      queryParameters['downloadType'] = downloadType;
    } else {
      queryParameters['downloadType'] = 'CITABLE';
    }


    this.addQueryToQueryParams(query, queryParameters);

    return this.http.post<string>(path, undefined, {params: queryParameters});
  }

  /**
   * Get count of results using given filter
   * Use this API to test how many results your query would return and then proceed with list query. Also returns max result count allowed for list queries.
   * @param query to make to the warehouse
   */
  public warehouseQueryCountGet(query: WarehouseQueryInterface, extraHttpRequestParams?: any): Observable<WarehouseCountResultInterface> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + this.subPath + 'count';

    if (WarehouseApi.isEmptyQuery(query) && typeof query.cache === 'undefined') {
      query = {...query, cache: true};
    }

    const queryParameters = {...extraHttpRequestParams};

    this.addQueryToQueryParams(query, queryParameters);

    return this.http.get<WarehouseCountResultInterface>(path, {params: WarehouseApi.prepareCountQuery(queryParameters)});
  }

  /**
   * Get list of results using given filter
   * Get list of results. Maximum number of results is 10000. Before making a list query, you should check with /count how many results the query yields. Application/json and application/xml responses respect the \&quot;selected\&quot; parameter, but application/dwc+xml does not support all fields.
   * @param query to make to the warehouse
   * @param selected Define what fields to include to the result. Defaults to [document.documentId, gathering.gatheringId, unit.unitId, document.sourceId, document.collectionId, document.namedPlaceId, document.secureLevel, document.secureReason, document.keywords, gathering.team, gathering.eventDate.begin, gathering.eventDate.end, gathering.timeBegin, gathering.timeEnd, gathering.higherGeography, gathering.country, gathering.province, gathering.municipality, gathering.locality, gathering.conversions.wgs84CenterPoint.lat, gathering.conversions.wgs84CenterPoint.lon, gathering.interpretations.coordinateAccuracy, gathering.interpretations.sourceOfCoordinates, unit.linkings.taxon.qname, unit.linkings.taxon.species, unit.linkings.taxon.scientificName, unit.linkings.taxon.vernacularName, unit.taxonVerbatim, unit.abundanceString, unit.recordBasis, unit.mediaCount, unit.notes] Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param orderBy Define what fields to use when sorting results. If using default select, defaults to [gathering.eventDate.begin DESC, document.loadDate DESC, unit.taxonVerbatim ASC]. If using custom select there is no default order. Each fieldname given as parameter defaults to ASC - if you want to sort using descending order, add \&quot; DESC\&quot; to the end of the field name. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param pageSize Set number of results in one page.
   * @param page Set current page.
   */
  public warehouseQueryListGet(query: WarehouseQueryInterface, selected?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, extraHttpRequestParams?: any): Observable<PagedResult<any>> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + this.subPath + 'list';

    if (WarehouseApi.isEmptyQuery(query) && typeof query.cache === 'undefined') {
      query = {...query, cache: true};
    }

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};

    this.addQueryToQueryParams(this.queryWithMetaData(query, selected, orderBy, pageSize, page), queryParameters);

    return this.http.get<PagedResult<any>>(path, {params: queryParameters});
  }

  /**
   * Get single full document.
   * Get single full document by document URI. Contains the document, gatherings and units, including facts, media etc
   * @param documentId Full document ID (URI identifier)
   */
  public warehouseQuerySingleGet(documentId: string, extraHttpRequestParams?: any): Observable<any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + '/warehouse/query/single';

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};
    // verify required parameter 'documentId' is not null or undefined
    if (documentId === null || documentId === undefined) {
      throw new Error('Required parameter documentId was null or undefined when calling warehouseQuerySingleGet.');
    }

    queryParameters['documentId'] = documentId;

    return this.http.get(path, {params: queryParameters});
  }

  /**
   * Get single full document.
   * Get single full document by document URI. Contains the document, gatherings and units, including facts, media etc
   * @param documentId Full document ID (URI identifier)
   */
  public warehouseQueryDocumentGet(documentId: string, extraHttpRequestParams?: any): Observable<any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + '/warehouse/query/document';

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};
    // verify required parameter 'documentId' is not null or undefined
    if (documentId === null || documentId === undefined) {
      throw new Error('Required parameter documentId was null or undefined when calling warehouseQueryDocumentGet.');
    }

    queryParameters['documentId'] = documentId;

    return this.http.get(path, {params: queryParameters});
  }
  /**
   * Get list of annotations using given filters
   * Get list of results as a 'flat row'. Application/json and application/xml responses respect the "selected" parameter, but application/dwc+xml (unfinished) does not support all fields.
   * @param query to make to the warehouse
   * @param selected Define what fields to include to the result. Defaults to [document.documentId, gathering.gatheringId, unit.unitId, document.sourceId, document.collectionId, document.namedPlaceId, document.secureLevel, document.secureReason, document.keywords, gathering.team, gathering.eventDate.begin, gathering.eventDate.end, gathering.timeBegin, gathering.timeEnd, gathering.higherGeography, gathering.country, gathering.province, gathering.municipality, gathering.locality, gathering.conversions.wgs84CenterPoint.lat, gathering.conversions.wgs84CenterPoint.lon, gathering.interpretations.coordinateAccuracy, gathering.interpretations.sourceOfCoordinates, unit.linkings.taxon.qname, unit.linkings.taxon.species, unit.linkings.taxon.scientificName, unit.linkings.taxon.vernacularName, unit.taxonVerbatim, unit.abundanceString, unit.recordBasis, unit.mediaCount, unit.notes] Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param orderBy Define what fields to use when sorting results. If using default select, defaults to [gathering.eventDate.begin DESC, document.loadDate DESC, unit.taxonVerbatim ASC]. If using custom select there is no default order. Each fieldname given as parameter defaults to ASC - if you want to sort using descending order, add \&quot; DESC\&quot; to the end of the field name. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param pageSize Set number of results in one page.
   * @param page Set current page.
   */
  public warehouseQueryAnnotationListGet(query: WarehouseQueryInterface, selected?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, extraHttpRequestParams?: any): Observable<any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + '/warehouse/query/annotation/list';

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};

    this.addQueryToQueryParams(this.queryWithMetaData(query, selected, orderBy, pageSize, page), queryParameters);

    return this.http.get<any>(path, {params: queryParameters});
  }

  /**
   * Get list of unit media using given filter
   * @param query to make to the warehouse
   * @param selected Define what fields to include to the result. Defaults to [document.documentId, gathering.gatheringId, unit.unitId, document.sourceId, document.collectionId, document.namedPlaceId, document.secureLevel, document.secureReason, document.keywords, gathering.team, gathering.eventDate.begin, gathering.eventDate.end, gathering.timeBegin, gathering.timeEnd, gathering.higherGeography, gathering.country, gathering.province, gathering.municipality, gathering.locality, gathering.conversions.wgs84CenterPoint.lat, gathering.conversions.wgs84CenterPoint.lon, gathering.interpretations.coordinateAccuracy, gathering.interpretations.sourceOfCoordinates, unit.linkings.taxon.qname, unit.linkings.taxon.species, unit.linkings.taxon.scientificName, unit.linkings.taxon.vernacularName, unit.taxonVerbatim, unit.abundanceString, unit.recordBasis, unit.mediaCount, unit.notes] Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param orderBy Define what fields to use when sorting results. If using default select, defaults to [gathering.eventDate.begin DESC, document.loadDate DESC, unit.taxonVerbatim ASC]. If using custom select there is no default order. Each fieldname given as parameter defaults to ASC - if you want to sort using descending order, add \&quot; DESC\&quot; to the end of the field name. Multiple values are seperated by a comma (,) or by giving the HTTP parameter multiple times.
   * @param pageSize Set number of results in one page.
   * @param page Set current page.
   */
  public warehouseQueryUnitMediaListGet(query: WarehouseQueryInterface, selected?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number, extraHttpRequestParams?: any): Observable<PagedResult<any>> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + '/warehouse/query/unitMedia/list';

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};

    this.addQueryToQueryParams(this.queryWithMetaData(query, selected, orderBy, pageSize, page), queryParameters);

    return this.http.get<PagedResult<any>>(path, {params: queryParameters});
  }

  /**
   * Enumeration labels.
   * Get descriptions of enumerations that are used in query parameters and responses.
   */
  public warehouseEnumerationLabels(extraHttpRequestParams?: any): Observable<any> {
    if (this.platformService.isServer) {
      return EMPTY;
    }
    const path = this.basePath + '/warehouse/enumeration-labels';

    const queryParameters = {...Util.removeFromObject(extraHttpRequestParams)};

    return this.http.get(path, {params: queryParameters});
  }

  private queryWithMetaData(query: WarehouseQueryInterface, selectedOrAggregatedBy?: Array<string>, orderBy?: Array<string>, pageSize?: number, page?: number): any {
    return {
      ...query,
      aggregateBy: selectedOrAggregatedBy,
      selected: selectedOrAggregatedBy,
      orderBy: orderBy,
      pageSize: pageSize,
      page: page
    };
  }

  private addQueryToQueryParams(query: WarehouseQueryInterface, queryParameters: object): void {
    this.queryService.getURLSearchParams(query, queryParameters);
  }

}
