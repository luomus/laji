<div class="lj-select" [ngClass]="{'lj-close': open, 'lj-open': !open, 'lj-disabled': disabled}">
  <strong *ngIf="title !== undefined && title !== ''" class="lj-title link" (click)="toggle($event, filter)">{{ title }}<laji-info *ngIf="info" [html]="info"></laji-info></strong>
{{ selectedOptions | json }}
  <!-- GLOBAL FILTER -->
  <laji-select
  [options]="options['GLOBAL']"
  [subCategories]="subCategories"
  [filterPlaceHolder]="'haseka.submissions.filter' | translate"
  [useFilter]="false"
  [selected]="selectedOptions['GLOBAL']"
  [selectedGlobalSubCategories]="selectedOptions"
  [multiple]="true"
  [info]="info"
  [open]="open"
  [disabled]="false"
  [loading]="options['GLOBAL'] === null"
  [isParentFilter]="true"
  (selectedChange)="refreshValue($event, 'GLOBAL')"
></laji-select>
  
  <!-- SUBCATEGORIES-->
  <div *ngIf="open || (!open && !selectedOptionsIsEmpty(selectedOptions))"><strong>{{ subTitleBase + '.GLOBAL' | translate }}</strong><laji-info placement="left">{{ 'observation.active.recordQuality.GLOBAL.info' | translate }}</laji-info></div>
  <ng-container *ngFor="let subCategory of subCategories | excludeSubcategory : ['GLOBAL']">
    <label *ngIf="open || (!open && !selectedOptionsIsEmpty(selectedOptions[subCategory]))" class="lj-item selected" (click)="labelClick($event)">
      <laji-checkbox [threeState]="true" [hasSubCategories]="true" [value]="checkStatusSubCategory(selectedOptions[subCategory], options[subCategory])" (valueChange)="toggleSubCategories(subCategory, selectedOptions[subCategory], options[subCategory])"></laji-checkbox> <strong>{{ 'observation.active.recordQuality.'+ subCategory | translate }}</strong>
    </label>
    <laji-select
      [options]="options[subCategory]"
      [title]="subTitleBase + '.' + subCategory | translate"
      [subCategories]="subCategories"
      [subCategory]="subCategory"
      [filterPlaceHolder]="'haseka.submissions.filter' | translate"
      [useFilter]="false"
      [selected]="selectedOptions[subCategory]"
      [selectedGlobalSubCategories] = "selectedOptions"
      [multiple]="true"
      [info]="info"
      [open]="open"
      [disabled]="false"
      [loading]="options[subCategory] === null"
      (selectedChange)="refreshValue($event, subCategory)"
    ></laji-select>

  </ng-container>

  <!--<ng-container *ngFor="let subCategory of subCategories; let y = index;">
    <ng-container *ngIf="!open">
      <ng-container *ngIf="selectedOptions[subCategory] && selectedOptions[subCategory].length > 0">
        <div><strong *ngIf="y === 1">{{ subTitleBase + '.' + subCategories[y-1] | translate }}</strong><laji-info *ngIf="y === 1" placement="left">{{ 'observation.active.recordQuality.GLOBAL.info' | translate }}</laji-info></div>
        <label class="lj-item selected" *ngIf="y > 0" (click)="labelClick($event)">
          <laji-checkbox [threeState]="true" [hasSubCategories]="true" [value]="checkStatusSubCategory(selectedOptions[subCategory], options[subCategory])" (valueChange)="toggleSubCategories(subCategory, selectedOptions[subCategory], options[subCategory])"></laji-checkbox><strong>{{ subCategory === 'GLOBAL' ? (subTitleBase | translate)  : ( subTitleBase + '.' + subCategory | translate ) }}</strong>
        </label>
      </ng-container>
      <span class="item" *ngFor="let option of selectedOptions[subCategory]; trackBy: track">
        <label class="lj-item selected" [ngClass]="{'subMenu': y > 0, '': y ===0}" (click)="labelClick($event)">
        <laji-checkbox [threeState]="true" [hasSubCategories]="true" [value]="true" (valueChange)="remove(option, subCategory)"></laji-checkbox> {{ option | warehouse | label }}
        </label>
        <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
      </span>
    </ng-container>
    <div *ngIf="open" class="lj-item-container" [ngClass]="{'subCategoryBox' : subCategory !== 'GLOBAL', '' : subCategory === 'GLOBAL'}">
      <div><strong *ngIf="y === 1">{{ subTitleBase + '.' + subCategories[y-1] | translate }}</strong><laji-info class="relative"  *ngIf="y === 1" placement="left">{{ 'observation.active.recordQuality.GLOBAL.info' | translate }}</laji-info></div>
      <label class="lj-item" *ngIf="y > 0" (click)="labelClick($event)">
        <laji-checkbox [threeState]="true" [hasSubCategories]="true" [value]="checkStatusSubCategory(selectedOptions[subCategory], options[subCategory])" (valueChange)="toggleSubCategories(subCategory, selectedOptions[subCategory], options[subCategory])"></laji-checkbox><strong>{{ subCategory === 'GLOBAL' ? (subTitleBase | translate)  : ( subTitleBase + '.' + subCategory | translate ) }}</strong>
      </label>
      <laji-spinner [spinning]="loading"></laji-spinner>
      <div [ngClass]="{'subCategoryItem' : subCategory !== 'GLOBAL', '' : subCategory === 'GLOBAL'}" *ngFor="let option of options[subCategory]; let i = index; trackBy: track" style="position: relative;">
        <label class="lj-item" (click)="labelClick($event)">
          <laji-checkbox [threeState]="true" [hasSubCategories]="true" [hasSubCategories]="true" [value]="checkStatus(option.id, subCategory)" (valueChange)="toggleValue(option.id, subCategory)"></laji-checkbox> {{ option.value}}
        </label>
        <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
      </div>
    </div>
  </ng-container>-->
</div>


<ng-template let-option="option" #value>
  <laji-info *ngIf="option.info" [html]="option.info"></laji-info>
</ng-template>
