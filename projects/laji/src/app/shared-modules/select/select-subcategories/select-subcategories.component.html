<div class="lj-select" [ngClass]="{'lj-close': open, 'lj-open': !open, 'lj-disabled': disabled}">
  <strong *ngIf="title !== undefined && title !== ''" class="lj-title link" (click)="toggle($event, filter)">{{ title }}<laji-info *ngIf="info" [html]="info"></laji-info></strong>
  <ng-container *ngFor="let subCategory of subCategories; let y = index;">
    <ng-container *ngIf="multiple; else select">
        <ng-container *ngIf="!useFilter; else multiWithFilter">
          <ng-container *ngIf="!open">
            <ng-container *ngIf="selectedOptions[subCategory] && selectedOptions[subCategory].length > 0">
              <div><strong *ngIf="y === 1">{{ subTitleBase + '.' + subCategories[y-1] | translate }}</strong></div>
              <strong>{{ subCategory === 'GLOBAL' ? (subTitleBase | translate)  : ( subTitleBase + '.' + subCategory | translate ) }}</strong>
            </ng-container>
            <span class="item" *ngFor="let option of selectedOptions[subCategory]; trackBy: track">
              <label class="lj-item selected" (click)="labelClick($event)">
                <laji-checkbox [threeState]="true" [value]="true" (valueChange)="remove(option, subCategory)"></laji-checkbox> {{ option | warehouse | label }}
              </label>
              <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
            </span>
          </ng-container>
          <div *ngIf="open" class="lj-item-container" [ngClass]="{'subCategoryBox' : subCategory !== 'GLOBAL', '' : subCategory === 'GLOBAL'}">
            <div><strong *ngIf="y === 1">{{ subTitleBase + '.' + subCategories[y-1] | translate }}</strong></div>
            <strong>{{ subCategory === 'GLOBAL' ? (subTitleBase | translate)  : ( subTitleBase + '.' + subCategory | translate ) }}</strong>
            <laji-spinner [spinning]="loading"></laji-spinner>
            <div [ngClass]="{'subCategoryItem' : subCategory !== 'GLOBAL', '' : subCategory === 'GLOBAL'}" *ngFor="let option of options[subCategory]; let i = index; trackBy: track" style="position: relative;">
              <label class="lj-item" (click)="labelClick($event)">
                <laji-checkbox [threeState]="true" [value]="checkStatus(option.id, subCategory)" (valueChange)="toggleValue(option.id, subCategory)"></laji-checkbox> {{ option.value}}
              </label>
              <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
            </div>
          </div>
        </ng-container>
        <ng-template #multiWithFilter>
          <span class="lj-container" *ngFor="let option of selectedOptions[subCategory]; trackBy: track">
            <label class="lj-item selected" (click)="labelClick($event)">
              <laji-checkbox [threeState]="true" [value]="true" (valueChange)="remove(option.id, subCategory)"></laji-checkbox>{{option.value}}
            </label>
            <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
          </span>
          <div class="lj-filter" [hidden]="!useFilter || !open">
            <input #filter (keyup)="onFilterChange($event, filter.value, subCategory)" class="form-control" type="search" placeholder="{{filterPlaceHolder}}">
          </div>
          <div *ngIf="open" class="lj-item-container">
            <div [class.lj-active]="i === selectedIdx" *ngFor="let option of (unselectedOptions[subCategory] | filter:filterBy ); let i = index; trackBy: track" style="position: relative;">
              <label class="lj-item" (click)="labelClick($event)">
                <laji-checkbox [threeState]="true" (valueChange)="add(option.id, subCategory)"></laji-checkbox> {{option.value}}
              </label>
              <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
            </div>
          </div>
        </ng-template>
      </ng-container>
  </ng-container>
</div>

<ng-template #select>
  <ng-container *ngFor="let subCategory of subCategories">
    <ng-container *ngIf="!open">
        <span class="lj-container" *ngFor="let option of selectedOptions[subCategory]; trackBy: track">
          <label class="lj-item selected" (click)="labelClick($event)">
            <laji-checkbox [threeState]="true" [value]="true" (valueChange)="remove(option.id, subCategory)"></laji-checkbox> {{ option.value }}
          </label>
          <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
        </span>
      </ng-container>
      <div class="lj-filter" [hidden]="!useFilter || !open">
        <input #filter (keyup)="onFilterChange($event, filter.value, subCategory)" class="form-control" type="search" placeholder="{{filterPlaceHolder}}">
      </div>
      <div *ngIf="open" class="lj-item-container">
        <laji-spinner [spinning]="loading"></laji-spinner>
        <div [class.lj-active]="i === selectedIdx" *ngFor="let option of (options[subCategory] | filter:filterBy ); let i = index; trackBy: track">
          <label class="lj-item" (click)="labelClick($event)">
            <laji-checkbox [threeState]="true" [value]="checkStatus(option.id, subCategory)" (valueChange)="toggleValue(option.id, subCategory)"></laji-checkbox>{{ option.value }} aa
          </label>
          <ng-container [ngTemplateOutlet]="value" [ngTemplateOutletContext]="{option: option}"></ng-container>
        </div>
      </div>
  </ng-container>
</ng-template>

<ng-template let-option="option" #value>
  <laji-info *ngIf="option.info" [html]="option.info"></laji-info>
</ng-template>
