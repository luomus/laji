<!--<p>observation-effective-tags-taxon works!</p>-->

<div class="effective-taxon-tags">
  @if (showTitle) {
    <h4>{{ 'annotation.effectiveQualityMarkings' | translate }}</h4>
  }
  @if (showRecordQuality) {
    @if (unit.interpretations && unit.interpretations.recordQuality && unit.interpretations.recordQuality !== 'NEUTRAL') {
      <laji-row [title]="'annotation.quality.grade' | translate" [noTitleSpace]="false" ngPreserveWhitespaces>
        @if (annotationResolving) {
          <div>
            <laji-spinner></laji-spinner>
          </div>
        } @else {
          {{ unit.interpretations.recordQuality | warehouse | label }}
        }
      </laji-row>
    }
  }
  @if (showEffectiveTag && unit.interpretations && unit.interpretations.effectiveTags && unit.interpretations.effectiveTags.length > 0) {
    <laji-row [title]="'annotation.effectiveTags' | translate" [noTitleSpace]="false" ngPreserveWhitespaces>
      @if (annotationResolving) {
        <div>
          <laji-spinner></laji-spinner>
        </div>
      } @else {
        @if (!unit.interpretations || !unit.interpretations.effectiveTags || unit.interpretations.effectiveTags.length === 0) {
          <div>
            {{ 'annotation.notEffectiveTags' | translate }}
          </div>
        } @else {
          @for (item of convertEffective$ | async; track item) {
            <div class="tag">
              <div class="annotation-marker" [ngClass]="{'positive': item.type==='MMAN.typePositiveQuality', 'check': item.type==='MMAN.typeCheck', 'negative': (item.type==='MMAN.typeNegativeQuality' || item.type==='MMAN.typeAdmin'), 'info': item.type ==='MMAN.typeSelf', 'self': item.type ==='MMAN.typeInfo' }" >
                <span>{{ item.name }}</span>
              </div>
            </div>
          }
        }
      }
    </laji-row>
  }
  @if (showEffectiveTaxon) {
    <laji-row [title]="'annotation.effectiveTaxon' | translate" [noTitleSpace]="false" ngPreserveWhitespaces>
      @if (annotationResolving) {
        <div>
          <laji-spinner></laji-spinner>
        </div>
      } @else {
        @if (unit.linkings && unit.linkings.taxon || unit.taxonVerbatim || unit.reportedInformalTaxonGroup) {
          <div>
            @if (unit.linkings && unit.linkings.taxon) {
              <span>
                <laji-taxon-name [capitalizeName]="true" [taxon]="unit.linkings.taxon"></laji-taxon-name>
              </span>
            } @else {
              @if (unit.taxonVerbatim) {
                <span>{{ unit.taxonVerbatim | toQName | label }}</span>
              } @else {
                <span>{{ unit.reportedInformalTaxonGroup | toQName | label }}</span>
              }
            }
            @if (unit.interpretations && unit.interpretations.needsCheck) {
              <span class="needsCheck">{{ 'annotation.needsCheck' | translate }}</span>
            }
            @if (haschangedTaxon) {
              <span class="small-text">{{ 'annotation.effectiveTaxon.comment' | translate }}</span>
            }
          </div>
        }
      }
    </laji-row>
  }
  @if (showEffectiveAtlasCode && unit.atlasCode) {
    <laji-row [title]="'annotation.effectiveAtlasCode' | translate"  [noTitleSpace]="false" ngPreserveWhitespaces>
      @if (annotationResolving) {
        <div>
          <laji-spinner></laji-spinner>
        </div>
      } @else {
        <div>
          <span>
            {{ unit.atlasCode | label:"fullUri" }}
          </span>
        </div>
      }
    </laji-row>
  }
</div>


