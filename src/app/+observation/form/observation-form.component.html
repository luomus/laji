<div class="mode-select">
  <div class="form-group">
    <div class="col-sm-12">
      <span class="badge link" [class.active]="!advancedMode" (click)="setAdvancedMode(false)">
        {{ 'observation.form.modeBasic' | translate }}
      </span>
      <span class="badge link" [class.active]="advancedMode" (click)="setAdvancedMode(true)">
        {{ 'observation.form.modeAdvanced' | translate }}
      </span>
    </div>
  </div>
</div>
<div class="taxon-panel">
  <div class="row">
    <div class="col-lg-12">
      <label>{{ 'observation.active.informalTaxonGroupId' | translate }}</label><laji-info>{{ 'observation.info.informalTaxonGroup' | translate }}</laji-info>
    </div>
  </div>
  <div class="row">
    <div class="lj-input-wrap">
      <laji-observation-group-select
        [(ngModel)]="formQuery.informalTaxonGroupId"
        name="informalTaxonGroupId"
        (select)="onFormQueryChange()">
        {{ 'observation.active.informalTaxonGroupAll'|translate }}
      </laji-observation-group-select>
    </div>
  </div>
  <div class="form-group">
    <div class="col-lg-12">
      <label>{{ 'observation.form.target' | translate }}</label><laji-info><span [innerHtml]="'observation.info.target' | translate"></span></laji-info>
    </div>
    <div class="col-lg-12">
      <input
        [ngClass]="{loading: typeaheadLoading}"
        type="text"
        class="form-control input-sm"
        name="target"
        [(ngModel)]="formQuery.taxon"
        [typeahead]="dataSource"
        [typeaheadOptionsLimit]="autocompleteLimit"
        [typeaheadWaitMs]="200"
        [typeaheadMinLength]="3"
        [typeaheadSelectFirstItem]="false"
        [typeaheadOptionField]="'value'"
        [typeaheadItemTemplate]="taxonItem"
        (typeaheadLoading)="changeTypeaheadLoading($event)"
        (typeaheadOnSelect)="onTaxonSelect($event)"
        (keyup)="onTaxonSelect($event)"
        autocomplete="off"
        autocorrect="off"
      >
      <ng-template #taxonItem let-model="item">
        <h5 class="autosuggest-value {{model.groups}} informal-group-image">
          {{ model.value }}
        </h5>
      </ng-template>
      <laji-pill-list
        [isLabel]="true"
        [list]="query.target || []"
        (updateList)="updateSearchQuery('target', $event)"
      ></laji-pill-list>
    </div>
  </div>
  <div *ngIf="advancedMode || visibleAdvanced['taxon']">
    <div class="row">
      <div class="col-lg-12">
        <label class="small-label">
          <laji-checkbox [(value)]="formQuery.taxonIncludeLower" (valueChange)="onFormQueryChange()"></laji-checkbox>
          {{ 'observation.keepSsp' | translate }}</label><laji-info>{{ 'observation.info.keepSsp' | translate }}</laji-info>
      </div>
    </div>
    <div class="form-group">
      <div class="col-lg-12">
        <label class="small-label">
          <laji-checkbox [(value)]="formQuery.taxonUseAnnotated" (valueChange)="onFormQueryChange()"></laji-checkbox>
          {{ 'observation.changedNames' | translate }}</label><laji-info>
          {{ 'observation.info.changedNames' | translate }}
        </laji-info>
      </div>
    </div>
  </div>
  <div class="form-group">
    <div class="col-sm-12">
      <laji-select
        [selected]="query.typeOfOccurrenceId"
        (selectedChanged)="indirectQueryChange('typeOfOccurrenceId', $event)"
        [useFilter]="false"
        [title]="'observation.commonness' | translate"
        [info]="'observation.info.commonness' | translate"
        [options]="[
              {id: 'MX.typeOfOccurrenceCommon', value: ('MX.typeOfOccurrenceCommon' | label)},
              {id: 'MX.typeOfOccurrenceRare', value: ('MX.typeOfOccurrenceRare' | label)},
              {id: 'MX.typeOfOccurrenceVeryRare', value: ('MX.typeOfOccurrenceVeryRare' | label)}
            ]"></laji-select>
    </div>
  </div>
</div>
<div class="row">
  <div *lajiLoggedIn="true">
    <div laji-panel [title]="'observation.form.own' | translate" [autoToggle]="true" [open]="visible['own']">
      <div class="row">
        <div class="col-sm-12">
          <label>
            <laji-checkbox [(value)]="formQuery.asObserver" (valueChange)="ownItemSelected()"></laji-checkbox>
            {{ 'observation.form.asObserver' | translate }}
          </label>
          <laji-info>
            {{ 'observation.info.asObserver' | translate }}
          </laji-info>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <label>
            <laji-checkbox [(value)]="formQuery.asEditor" (valueChange)="ownItemSelected()"></laji-checkbox>
            {{ 'observation.form.asEditor' | translate }}
          </label>
          <laji-info>
            {{ 'observation.info.asEditor' | translate }}
          </laji-info>
        </div>
      </div>
      <div class="row" *ngIf="formQuery.asEditor || formQuery.asObserver || query.qualityIssues">
        <div class="col-sm-12">
          <laji-select
            [selected]="[query.qualityIssues]"
            (selectedChanged)="indirectQueryChange('qualityIssues', $event[0])"
            [multiple]="false"
            [useFilter]="false"
            [title]="'observation.form.qualityIssues' | translate"
            [info]="'observation.info.qualityIssues' | translate"
            [options]="[
              {id: 'BOTH', value: ('observation.form.qualityIssuesBOTH' | translate)},
              {id: 'NO_ISSUES', value: ('observation.form.qualityIssuesNO_ISSUES' | translate)},
              {id: 'ONLY_ISSUES', value: ('observation.form.qualityIssuesONLY_ISSUES' | translate)}
            ]"></laji-select>
        </div>
      </div>
    </div>
  </div>
  <div laji-panel [title]="'observation.form.date' | translate" [autoToggle]="true"  [open]="visible['time']">
    <div class="row">
      <div class="col-sm-12">
        <label>{{ 'observation.form.time' | translate }}</label><laji-info>{{ 'observation.info.time' | translate }}
        </laji-info>
        <laji-datepicker
          [(ngModel)]="formQuery.timeStart"
          [viewFormat]="'DD.MM.YYYY'"
          [otherFormats]="['D.M.YYYY', 'YYYY']"
          [format]="dateFormat"
          (select)="onFormQueryChange()"
          (change)="onFormQueryChange()"
          name="timeStart"></laji-datepicker>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <laji-datepicker
          [(ngModel)]="formQuery.timeEnd"
          [viewFormat]="'DD.MM.YYYY'"
          [otherFormats]="['D.M.YYYY', 'YYYY']"
          [toLastOfYear]="true"
          [format]="dateFormat"
          (select)="onFormQueryChange()"
          (change)="onFormQueryChange()"
          name="timeEnd"></laji-datepicker>
      </div>
    </div>
    <div class="form-group">
      <div class="col-lg-12">
        <div class="btn-group">
          <button type="button" class="btn btn-sm btn-default" (click)="updateTime(1)">{{ 'observations.form.1d' | translate }}</button>
          <button type="button" class="btn btn-sm btn-default" (click)="updateTime(7)">{{ 'observations.form.7d' | translate }}</button>
          <button type="button" class="btn btn-sm btn-default" (click)="updateTime(365)">
            {{ 'observation.form.thisYear' | translate }}
          </button>
        </div>
      </div>
    </div>
    <ng-container *ngIf="advancedMode || query.season">
      <div class="form-group">
        <div class="col-lg-12">
          <label>{{ 'observation.form.season' | translate }}</label><laji-info>{{ 'observation.info.season' | translate }}</laji-info>
            <laji-season [season]="query.season" (seasonChange)="updateSearchQuery('season', $event)"></laji-season>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="advancedMode || visibleAdvanced['time']">
      <div class="row">
        <div class="lj-input-wrap">
          <label>{{ 'observation.form.loaded' | translate }}</label><laji-info>{{ 'observation.info.loaded' | translate }}</laji-info>
          <laji-datepicker
            [(ngModel)]="query.firstLoadedSameOrAfter"
            [viewFormat]="'DD.MM.YYYY'"
            [otherFormats]="['D.M.YYYY', 'YYYY']"
            [format]="dateFormat"
            (select)="onQueryChange()"
            (change)="onQueryChange()"
            name="timeStart"></laji-datepicker>
        </div>
      </div>
      <div class="row">
        <div class="lj-input-wrap">
          <laji-datepicker
            [(ngModel)]="query.firstLoadedSameOrBefore"
            [viewFormat]="'DD.MM.YYYY'"
            [otherFormats]="['D.M.YYYY', 'YYYY']"
            [toLastOfYear]="true"
            [format]="dateFormat"
            (select)="onQueryChange()"
            (change)="onQueryChange()"
            name="timeEnd"></laji-datepicker>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <div class="btn-group">
            <button type="button" class="btn btn-sm btn-default" (click)="updateTime(1, 'loaded')">{{ 'observations.form.1d' | translate }}</button>
            <button type="button" class="btn btn-sm btn-default" (click)="updateTime(7, 'loaded')">{{ 'observations.form.7d' | translate }}</button>
            <button type="button" class="btn btn-sm btn-default" (click)="updateTime(365, 'loaded')">
              {{ 'observation.form.thisYear' | translate }}
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div laji-panel
       [autoToggle]="true"
       [open]="showPlace || visible['place']"
       (activate)="togglePlace($event)"
       [title]="'observation.form.place' | translate">
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [info]="'observation.info.country' | translate"
          [(ngModel)]="query.countryId"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [firstOptions]="['ML.206']"
          [placeholder]="'result.gathering.country'"
          name="countryId"
          [field]="areaType.Country"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [info]="'observation.info.biogeographicalProvince' | translate"
          [(ngModel)]="query.biogeographicalProvinceId"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [placeholder]="'result.gathering.biogeographicalProvince'"
          name="biogeographicalProvinceId"
          [field]="areaType.Biogeographical"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [info]="'observation.info.municipality' | translate"
          [(ngModel)]="query.finnishMunicipalityId"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [placeholder]="'observation.form.municipality'"
          name="finnishMunicipalityId"
          [field]="areaType.Municipality"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-lg-12">
        <label>{{ 'observation.form.area' | translate }}</label><laji-info>
        {{ 'observation.info.area' | translate }}
      </laji-info>
      </div>
      <div class="col-lg-12">
        <input
          class="form-control input-sm"
          type="text"
          name="documentId"
          (ngModelChange)="delayedQueryChange()"
          [(ngModel)]="query.area">
      </div>
    </div>
    <hr>
    <div class="form-group">
      <div class="col-sm-12">
        <label>{{ 'observation.form.map.intro'|translate }}</label>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <button type="button" class="lji-btn-sm btn btn-sm btn-default" (click)="mapDraw.emit('Rectangle')">
          <i class="lji-icon lji-crop"></i>
        </button>
        {{ (drawing && drawingShape === 'Rectangle' ?  'observation.form.map.rectangle.active' : 'observation.form.map.rectangle') | translate }}
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <button type="button" class="lji-btn-sm btn btn-sm btn-default" (click)="mapDraw.emit('Coordinates')">
          YKJ
        </button>
        {{ 'observation.form.map.coordinates'|translate }}
      </div>
    </div>
    <ng-container *ngIf="advancedMode || visibleAdvanced['coordinate']">
      <ng-container *ngIf="query.coordinates">
        <div class="row">
          <div class="col-sm-12">
            <label class="small-label">{{ 'observation.form.coordinateIntersection' | translate }}</label><laji-info>{{ 'observation.info.coordinateIntersection' | translate }}</laji-info>
            <div class="input-group" style="max-width: 110px;">
              <input type="number"
                     name="coordinatesIntersection"
                     style="padding: 3px 7px;"
                     class="form-control input-sm"
                     (change)="delayedQueryChange()"
                     [(ngModel)]="query._coordinatesIntersection">
              <span class="input-group-addon">%</span>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <input id="coordinateIntersection"
                   type="range"
                   name="sliderCoordinatesIntersection"
                   class="form-control input-sm"
                   step="10"
                   min="0"
                   max="100"
                   list="coordinateIntersectionSrc"
                   (change)="onQueryChange()"
                   [(ngModel)]="query._coordinatesIntersection">
            <datalist id="coordinateIntersectionSrc">
              <option value="0">
              <option value="10">
              <option value="20">
              <option value="30">
              <option value="40">
              <option value="50">
              <option value="60">
              <option value="70">
              <option value="80">
              <option value="90">
              <option value="100">
            </datalist>
          </div>
        </div>
        <div class="row" style="margin-top: 5px; margin-bottom: 5px;">
          <div class="col-sm-12" style="padding-right: 3px">
            <div class="btn-group">
              <button type="button" class="btn btn-default btn-xs" (click)="updateSearchQuery('_coordinatesIntersection', 0)">
                {{ 'observation.form.intersect0' | translate }}
              </button>
              <button type="button" class="btn btn-default btn-xs" (click)="updateSearchQuery('_coordinatesIntersection', 100)">
                {{ 'observation.form.intersect100' | translate }}
              </button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-12">
          </div>
        </div>
      </ng-container>
      <hr>
      <div class="row">
        <div class="col-sm-12">
          <label>{{ 'observation.form.coordinateAccuracyMax' | translate }}</label><laji-info>{{ 'observation.info.coordinateAccuracyMax' | translate }}</laji-info>
            <div class="input-group" style="max-width: 110px;">
              <input type="number" name="coordinateAccuracyMax"
                     style="padding: 3px 7px;"
                     class="form-control input-sm"
                     (change)="onAccuracyValueChange()"
                     [(ngModel)]="query.coordinateAccuracyMax">
              <span class="input-group-addon">m</span>
            </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <input id="logCoordinateAccuracyMax"
                 [ngClass]="{faded: !query.coordinateAccuracyMax}"
                 type="range" name="logCoordinateAccuracyMax"
                 class="form-control input-sm"
                 step="1"
                 min="0"
                 max="5"
                 list="accuracyPowers"
                 (click)="enableAccuracySlider()"
                 (change)="onAccuracySliderChange()"
                 [(ngModel)]="logCoordinateAccuracyMax">
          <datalist id="accuracyPowers">
            <option value="0">
            <option value="1">
            <option value="2">
            <option value="3">
            <option value="4">
            <option value="5">
          </datalist>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <label>
            <laji-checkbox [(value)]="formQuery.coordinatesInSource" (valueChange)="onFormQueryChange()"></laji-checkbox>
            {{ 'observation.form.sourceOfCoordinates' | translate }}
          </label>
          <laji-info>
            {{ 'observation.info.sourceOfCoordinates' | translate }}
          </laji-info>
        </div>
      </div>
    </ng-container>
  </div>
  <div laji-panel [title]="'observation.form.observer' | translate" [autoToggle]="true"  [open]="visible['observer']">
    <div class="row">
      <div class="col-lg-12">
        <label>{{ 'observation.form.team' | translate }}</label><laji-info>{{ 'observation.info.team' | translate }}
      </laji-info>
      </div>
      <div class="col-lg-12">
        <laji-team
          [(memberIds)]="query.teamMemberId"
          [(members)]="query.teamMember"
          (update)="onQueryChange()"
        ></laji-team>
      </div>
    </div>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['individual']" [title]="'observation.form.unit' | translate" [autoToggle]="true"  [open]="visible['individual']">
    <div class="form-group">
      <div class="col-lg-12">
        <laji-metadata-select
          [(ngModel)]="query.sex"
          [alt]="'MY.sexes'"
          [multiple]="true"
          [placeholder]="'observation.form.sex'"
          (ngModelChange)="onQueryChange()"
          [mapToWarehouse]="true"
          [useFilter]="false"
          name="sex"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-lg-12">
        <laji-metadata-select
          [(ngModel)]="query.lifeStage"
          (ngModelChange)="onQueryChange()"
          [alt]="'MY.lifeStages'"
          [multiple]="true"
          [useFilter]="false"
          [placeholder]="'MY.lifeStage' | label"
          [mapToWarehouse]="true"
          name="lifeStage"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [(ngModel)]="query.recordBasis"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [useFilter]="false"
          name="recordBasis"
          [mapToWarehouse]="true"
          [placeholder]="'MY.recordBasis' | label"
          [alt]="'MY.recordBases'"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-select
          [selected]="[query.nativeOccurrence]"
          (selectedChanged)="indirectQueryChange('nativeOccurrence', $event[0])"
          [multiple]="false"
          [useFilter]="false"
          [title]="'observation.form.nativeOccurrence' | translate"
          [info]="'observation.info.nativeOccurrence' | translate"
          [options]="[
            {id: true, value: ('observation.form.nativeOccurrenceTrue' | translate)},
            {id: false, value: ('observation.form.nativeOccurrenceFalse' | translate)}
          ]"></laji-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-select
          [selected]="[query.breedingSite]"
          (selectedChanged)="indirectQueryChange('breedingSite', $event[0])"
          [multiple]="false"
          [useFilter]="false"
          [title]="'observation.form.breedingSite' | translate"
          [info]="'observation.info.breedingSite' | translate"
          [options]="[
            {id: true, value: ('observation.form.breedingSiteTrue' | translate)},
            {id: false, value: ('observation.form.breedingSiteFalse' | translate)}
          ]"></laji-select>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <label>{{ 'observation.form.count' | translate }}</label><laji-info>{{ 'observation.info.count' | translate }}
      </laji-info>
      </div>
      <div class="col-lg-12">
        <div class="row">
          <div class="col-sm-6">
            <input type="number" name="individualCountMin"
                   class="form-control input-sm"
                   placeholder="{{'observation.form.countMin' | translate}}"
                   (ngModelChange)="onCountChange()"
                   [(ngModel)]="query.individualCountMin">
          </div>
          <div class="col-sm-6">
            <input type="number" name="individualCountMax"
                   class="form-control input-sm"
                   placeholder="{{'observation.form.countMax' | translate}}"
                   (ngModelChange)="onCountChange()"
                   [(ngModel)]="query.individualCountMax">
          </div>
        </div>
        <div class="row" style="margin-top: 5px; margin-bottom: 5px;">
          <div class="col-sm-12">
            <button type="button" class="btn btn-default btn-xs" (click)="zeroObservations()">
              {{ 'observation.form.onlyZeroObservations' | translate }}
            </button>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <button type="button" class="btn btn-default btn-xs" (click)="zeroObservations(false)">
              {{ 'observation.form.zeroObservations' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div laji-panel [title]="'observation.form.qualityTitle' | translate" [autoToggle]="true" [open]="visible['quality']">
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [(ngModel)]="query.taxonReliability"
          [info]="'observation.info.reliability' | translate"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [useFilter]="false"
          name="taxonReliability"
          [mapToWarehouse]="true"
          [placeholder]="'reliability' | translate"
          [skip]="['MAN.annotationClassAcknowledged']"
          [alt]="'MAN.annotationClassEnum'"></laji-metadata-select>
      </div>
    </div>
    <ng-container *ngIf="advancedMode || query.annotated">
      <div class="form-group">
        <div class="col-sm-12">
          <laji-select
            [selected]="[query.annotated]"
            (selectedChanged)="indirectQueryChange('annotated', $event[0])"
            [multiple]="false"
            [useFilter]="false"
            [title]="'observation.form.annotated' | translate"
            [options]="[
              {id: true, value: ('observation.form.annotatedTrue' | translate)},
              {id: false, value: ('observation.form.annotatedFalse' | translate)}
            ]"></laji-select>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="advancedMode || query.qualityIssues">
      <div class="row">
        <div class="col-sm-12">
          <laji-select
            [selected]="[query.qualityIssues]"
            (selectedChanged)="indirectQueryChange('qualityIssues', $event[0])"
            [multiple]="false"
            [useFilter]="false"
            [title]="'observation.form.qualityIssues' | translate"
            [info]="'observation.info.qualityIssues' | translate"
            [options]="[
              {id: 'BOTH', value: ('observation.form.qualityIssuesBOTH' | translate)},
              {id: 'NO_ISSUES', value: ('observation.form.qualityIssuesNO_ISSUES' | translate)},
              {id: 'ONLY_ISSUES', value: ('observation.form.qualityIssuesONLY_ISSUES' | translate)}
            ]"></laji-select>
        </div>
      </div>
    </ng-container>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['dataset']" [title]="'observation.form.datasetTitle' | translate" [autoToggle]="true"  [open]="visible['dataset']">
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [(ngModel)]="query.collectionId"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [field]="'MY.collectionID'"
          [placeholder]="'observation.form.dataset' | translate"
          [info]="'observation.info.dataset' | translate"
          [mapToWarehouse]="false"
          name="collectionID"></laji-metadata-select>
      </div>
    </div>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-select
          [selected]="query.reliabilityOfCollection"
          (selectedChanged)="indirectQueryChange('reliabilityOfCollection', $event)"
          [multiple]="true"
          [useFilter]="false"
          [title]="'observation.form.reliabilityOfCollection' | translate"
          [info]="'observation.info.reliabilityOfCollection' | translate"
          [options]="[
            {id: '1', value: '★'},
            {id: '2', value: '★★'},
            {id: '3', value: '★★★'},
            {id: '4', value: '★★★★'},
            {id: '5', value: '★★★★★'}
          ]"></laji-select>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <laji-metadata-select
          [(ngModel)]="query.sourceId"
          [info]="'observation.info.system' | translate"
          (ngModelChange)="onSystemIDChange()"
          [placeholder]="'observation.form.system'"
          [multiple]="true"
          name="sourceId"
          [field]="'KE.informationSystem'"></laji-metadata-select>
      </div>
    </div>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['collection']" [title]="'observation.form.collectionTitle' | translate" [autoToggle]="true"  [open]="visible['collection']">
    <div class="row">
      <div class="col-lg-12">
        <label>
          <laji-checkbox [(value)]="formQuery.onlyFromCollectionSystems" (valueChange)="onOnlyFromCollectionCheckBoxToggle()"></laji-checkbox>
          {{ 'observation.form.collection' | translate }}
        </label>
        <laji-info>
          {{ 'observation.info.collection' | translate }}
        </laji-info>
      </div>
    </div>
    <div class="form-group">
      <div class="col-lg-12">
        <label>
          <laji-checkbox [value]="query.typeSpecimen" (valueChange)="onCheckBoxToggle('typeSpecimen')"></laji-checkbox>
          {{ 'observation.form.typeSpecimen' | translate }}
        </label>
        <laji-info [html]="'observation.info.typeSpecimen' | translate"></laji-info>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <laji-metadata-select
          [(ngModel)]="query.collectionId"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [field]="'MY.collectionID'"
          [placeholder]="'MY.collectionID' | label"
          [mapToWarehouse]="false"
          name="collectionID"></laji-metadata-select>
      </div>
    </div>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['keywords']" [title]="'observation.form.keywords' | translate" [autoToggle]="true" [open]="visible['keywords']">
    <div class="form-group">
      <div class="col-lg-12">
        <label>{{ 'observation.form.documentId' | translate }}</label><laji-info>{{ 'observation.info.documentId' | translate }}</laji-info>
      </div>
      <div class="col-lg-12">
        <input
          class="form-control input-sm"
          type="text"
          name="documentId"
          (ngModelChange)="delayedQueryChange()"
          [(ngModel)]="query.documentId">
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <label>{{ 'observation.form.keyword' | translate }}</label><laji-info>{{ 'observation.info.keyword' | translate }}</laji-info>
      </div>
      <div class="col-lg-12">
        <input
          class="form-control input-sm"
          type="text"
          name="documentId"
          (ngModelChange)="delayedQueryChange()"
          [(ngModel)]="query.keyword">
      </div>
    </div>
  </div>
  <div laji-panel [title]="'observation.form.speciesFeatures' | translate" [autoToggle]="true" [open]="visible['features']">
    <ng-container *ngIf="advancedMode || query.administrativeStatusId">
      <div class="form-group">
        <div class="col-sm-12">
          <p>
            {{ 'observation.intro.adminStatus' | translate }}
          </p>
          <laji-metadata-select
            [info]="'observation.info.adminStatus' | translate"
            [(ngModel)]="query.administrativeStatusId"
            (ngModelChange)="onAdministrativeStatusChange()"
            [multiple]="true"
            [placeholder]="'MX.hasAdminStatus' | label"
            name="administrativeStatusId"
            [alt]="'MX.adminStatusEnum'"></laji-metadata-select>
        </div>
      </div>
    </ng-container>
    <div class="form-group">
      <div class="col-sm-12">
        <laji-metadata-select
          [info]="'observation.info.redListStatus' | translate"
          [(ngModel)]="query.redListStatusId"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [useFilter]="false"
          name="redListStatusId"
          [placeholder]="'observation.form.redListStatusId'"
          [alt]="'MX.iucnStatuses'"></laji-metadata-select>
      </div>
    </div>
    <ng-container *ngIf="advancedMode || query.primaryHabitat || query.anyHabitat">
      <laji-habitat-select
        [query]="query"
        (select)="onHabitatChange($event)"
      ></laji-habitat-select>
    </ng-container>
    <ng-container *ngIf="advancedMode || query.typeOfOccurrenceId">
      <div class="form-group">
        <div class="col-sm-12">
          <p>
            {{ 'observation.intro.typeOfOccurrenceId' | translate }}
          </p>
          <laji-three-state-multi-switch
            [title]="'observation.form.typeOfOccurrenceId' | translate"
            [info]="'observation.info.typeOfOccurrenceId' | translate"
            [trueValue]="query.typeOfOccurrenceId"
            [falseValue]="query.typeOfOccurrenceIdNot"
            [alt]="'MX.typeOfOccurrenceEnum'"
            (update)="updateTypeOfOccurrence($event)"
          ></laji-three-state-multi-switch>
        </div>
      </div>
    </ng-container>
    <div class="form-group">
      <div class="col-sm-12">
        <label>{{ 'observation.form.invasive' | translate }}</label><laji-info>{{ 'observation.info.invasive' | translate }}</laji-info><br>
        <laji-three-state-switch
          (change)="onQueryChange()"
          [onText]="'yes' | translate"
          [offText]="'no' | translate"
          [(value)]="query.invasive">
        </laji-three-state-switch>
      </div>
    </div>
    <ng-container *ngIf="advancedMode || (query.finnish | exists)">
      <div class="row">
        <div class="col-sm-12">
          <label>{{ 'observation.form.finnish' | translate }}</label><laji-info>{{ 'observation.info.finnish' | translate }}</laji-info><br>
          <laji-three-state-switch
            (change)="onQueryChange()"
            [onText]="'yes' | translate"
            [offText]="'no' | translate"
            [(value)]="query.finnish">
          </laji-three-state-switch>
        </div>
      </div>
    </ng-container>
  </div>
  <div laji-panel *ngIf="advancedMode" [title]="'observation.form.invasiveClassification' | translate" [autoToggle]="true"  [open]="visible['invasive']">
    <div class="row" *lajiForTypes="['vir']">
      <div class="col-sm-12">
        <laji-metadata-select
          [multiple]="true"
          name="invasiveControlEffectiveness"
          [placeholder]="'MY.invasiveControlEffectiveness' | label"
          [alt]="'MY.invasiveControlEffectivenessEnum'"></laji-metadata-select>
      </div>
    </div>
    <hr *lajiForTypes="['vir']">
    <div class="row">
      <div class="col-sm-12">
        <label class="small-label">
          <laji-checkbox [value]="formQuery.euInvasiveSpeciesList" (valueChange)="onInvasiveCheckBoxToggle('euInvasiveSpeciesList')"></laji-checkbox>
          {{ 'MX.euInvasiveSpeciesList' | label }}
        </label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="small-label">
          <laji-checkbox [value]="formQuery.nationallySignificantInvasiveSpecies" (valueChange)="onInvasiveCheckBoxToggle('nationallySignificantInvasiveSpecies')"></laji-checkbox>
          {{ 'MX.nationallySignificantInvasiveSpecies' | label }}
        </label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="small-label">
          <laji-checkbox [value]="formQuery.quarantinePlantPest" (valueChange)="onInvasiveCheckBoxToggle('quarantinePlantPest')"></laji-checkbox>
          {{ 'MX.quarantinePlantPest' | label }}
        </label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label class="small-label">
          <laji-checkbox [value]="formQuery.allInvasiveSpecies" (valueChange)="onInvasiveCheckBoxToggle(invasiveStatuses)"></laji-checkbox>
          {{ 'observation.form.allInvasive' | translate }}
        </label>
      </div>
    </div>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['image']" [title]="'observation.form.images' | translate" [autoToggle]="true" [open]="visible['image']">
    <div class="row">
      <div class="col-sm-12">
        <p>
          {{ 'observation.intro.images' | translate }}
        </p>
        <label>
          <laji-checkbox [value]="query.hasUnitMedia" (valueChange)="onCheckBoxToggle('hasUnitMedia')"></laji-checkbox>
          {{ 'observation.form.hasUnitMedia' | translate }}
        </label>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label>
          <laji-checkbox [value]="query.hasGatheringMedia" (valueChange)="onCheckBoxToggle('hasGatheringMedia')"></laji-checkbox>
          {{ 'observation.form.hasGatheringMedia' | translate }}</label><laji-info>{{ 'observation.info.hasGatheringMedia' | translate }}</laji-info>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <label>
          <laji-checkbox [value]="query.hasDocumentMedia" (valueChange)="onCheckBoxToggle('hasDocumentMedia')"></laji-checkbox>
          {{ 'observation.form.hasDocumentMedia' | translate }}
        </label>
        <laji-info>
          {{ 'observation.info.hasDocumentMedia' | translate }}
        </laji-info>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-sm-12">
        <p>{{ 'observation.intro.noImages' | translate }}</p>
        <label>
          <laji-checkbox [value]="query.hasUnitMedia === false" (valueChange)="onCheckBoxToggle('hasUnitMedia', false)"></laji-checkbox>
          {{ 'observation.form.hasNotMedia' | translate }}
        </label>
      </div>
    </div>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['secure']" [title]="'observation.form.securedPanel' | translate" [autoToggle]="true" [open]="visible['secret']">
    <div class="row">
      <div class="col-sm-12">
        <laji-metadata-select
          [info]="'observation.info.secureLevel' | translate"
          [(ngModel)]="query.secureLevel"
          (ngModelChange)="onQueryChange()"
          [multiple]="true"
          [useFilter]="false"
          [mapToWarehouse]="true"
          [skip]="['MX.secureLevelNoShow']"
          [placeholder]="'observation.form.secureLevel'"
          name="secureLevel"
          [alt]="'MX.secureLevels'"></laji-metadata-select>
      </div>
    </div>
  </div>
  <div laji-panel *ngIf="advancedMode || visibleAdvanced['identify']" [title]="'observation.form.identify' | translate" [autoToggle]="true" [open]="visible['identify']">
    <div class="form-group">
      <div class="col-sm-12">
        <label>
          <laji-checkbox [value]="query.unidentified" (valueChange)="onCheckBoxToggle('unidentified', true)"></laji-checkbox>
          {{ 'observation.form.unidentified' | translate }}
        </label>
        <laji-info [html]="'observation.info.unidentified' | translate"></laji-info>
      </div>
    </div>
  </div>
</div>
