<div class="finnish-selector">
  <lu-button [routerLink]="['/observation', this.lastTabActive] | localize" [queryParams]="query | toSafeQuery" [disabled]="active !== 'finnish'">
    {{ 'search.result.all' | translate }}</lu-button>
  <lu-button [routerLink]="'/observation/finnish' | localize" [queryParams]="query | toSafeQuery" [disabled]="active === 'finnish'">
    {{ 'search.result.finnish' | translate }}</lu-button>
  <ng-container *ngIf="active !== 'finnish'">
    <div>
      <strong>
        <laji-observation-count
          [loading]="loadingUnits"
          [value]="unitCount"></laji-observation-count>
      </strong>
      {{ 'observation.results.observation' | translate }}
    </div>
    <div>
      <strong>
        <laji-observation-count
          [loading]="loadingTaxa"
          [value]="speciesCount"></laji-observation-count>
      </strong>
      {{ 'observation.results.species' | translate }}
    </div>
  </ng-container>
  <ng-container *ngIf="active === 'finnish'">
    <div>
      <strong>
        <laji-observation-count
          [overrideInQuery]="{countryId: 'ML.206'}"
          [query]="query"></laji-observation-count>
      </strong>
      {{ 'observation.results.observation' | translate }}
    </div>
    <div>
      <strong>
        <laji-observation-count
          [overrideInQuery]="{countryId: 'ML.206', includeNonValidTaxa: false}"
          [query]="query"
          [field]="'unit.linkings.taxon.speciesId'"></laji-observation-count>
        {{ 'observation.results.species' | translate }}
      </strong>
    </div>
  </ng-container>
</div>

<lu-tabs *ngIf="active !== 'finnish'" [selectedIndex]="selectedIndex" (select)="onSelect($event)">
  <lu-tab [heading]="'search.result.map' | translate">
    <laji-observation-map
      [ready]="!loadingUnits"
      [unitCount]="unitCount"
      [showItemsWhenLessThan]="2000"
      [opacity]="0.5"
      [height]="500"
      [query]="query"
      [draw]="{rectangle: true, marker: false, polygon: false, polyline: false, circle: false}"
      [legend]="true"
      [initWithWorldMap]="true"
      (create)="pickLocation($event)"
    ></laji-observation-map>
  </lu-tab>
  <lu-tab [heading]="'search.result.list' | translate">
    <laji-observation-result-list
      [settings]="listSettings"
      (settingsChange)="listSettingsChange.emit($event)"
      [visible]="active === 'list'"
      [query]="query"
    ></laji-observation-result-list>
  </lu-tab>
  <lu-tab [heading]="'search.result.images' | translate">
    <div style="min-height: 180px; padding: 0 10px 0 0">
      <laji-gallery
        [showPopover]="true"
        [showViewSwitch]="true"
        [query]="query">
      </laji-gallery>
    </div>
  </lu-tab>
  <lu-tab [heading]="'search.result.species' | translate">
    <div class="species-list">
      <div class="row">
        <div class="col-sm-12">
          <laji-observation-table
            [visible]="active === 'species'"
            [pageSize]="100"
            [height]="'calc(80vh - 40px)'"
            [query]="query"
            [showSettingsMenu]="false"
            [showRowAsLink]="false"
            [isAggregate]="true"
            [selected]="['unit.species']"
          ></laji-observation-table>
        </div>
      </div>
    </div>
  </lu-tab>
  <lu-tab [heading]="'search.result.stats' | translate">
    <div *ngIf="activated['stats']">
      <div class="form-group">
        <div class="col-sm-12" style="height: 300px">
          <laji-observation-chart
            [lang]="lang"
            [query]="query"
            (queryChange)="queryChange.emit($event)"
            [height]="300"
            [showLegend]="true"
            [visible]="active === 'stats'"
          ></laji-observation-chart>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <div [hidden]="!hasYearData"
               class="panel panel-default"
               laji-panel
               [title]="'observation.results.yearChart' | translate"
               [open]="true"
               [autoToggle]="true"
          >
            <p class="disclaimer">
              {{ 'taxonomy.observations.yearChart.disclaimer' | translate }}
            </p>
            <laji-observation-year-chart
              [query]="query"
              (hasData)="hasYearData = $event"
            ></laji-observation-year-chart>
          </div>
          <div [hidden]="!hasMonthDayData"
               class="panel panel-default"
               laji-panel
               [title]="'observation.results.monthDayChart' |Â translate"
               [open]="true"
               [autoToggle]="true"
          >
            <laji-observation-month-day-chart
              [query]="query"
              (hasData)="hasMonthDayData = $event"
            ></laji-observation-month-day-chart>
          </div>
        </div>
      </div>
      <div class="form-group spacer">
        <div class="col-lg-12">
          <laji-observation-filters [visible]="active === 'stats'" [query]="query" (queryChange)="queryChange.emit($event)"></laji-observation-filters>
        </div>
      </div>
    </div>
  </lu-tab>
  <lu-tab [heading]="'search.result.load' | translate">
    <laji-observation-download
      [speciesCount]="speciesCount"
      [unitCount]="unitCount"
      [query]="query"
    ></laji-observation-download>
  </lu-tab>
  <lu-tab [heading]="'search.result.annotation' | translate">
    <laji-annotations [query]="query"></laji-annotations>
  </lu-tab>
</lu-tabs>

<div [hidden]="active !== 'finnish'" *ngIf="activated['finnish']">
  <laji-main-result [query]="query" [visible]="active === 'finnish'"></laji-main-result>
</div>
