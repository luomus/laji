<ul class="nav nav-pills">
  <li role="presentation" [ngClass]="{active: ['map', 'list', 'images', 'species', 'stats', 'load'].indexOf(active) > -1}">
    <a [routerLink]="['/observation', this.lastAllActive] | localize" [queryParams]="queryParams">
      <strong>{{ 'search.result.all' | translate }}</strong>
    </a>
  </li>
  <li role="presentation" class="beta" [ngClass]="{active: active === 'finnish'}">
    <a [routerLink]="'/observation/finnish' | localize" [queryParams]="queryParams">
      <strong>{{ 'search.result.finnish' | translate }}</strong>
    </a>
  </li>
  <li class="counts">
    <strong *ngIf="active !== 'finnish'">
      <laji-observation-count
        [timeout]="30000"
        [query]="searchQuery.query"
        [tick]="searchQuery.tack"></laji-observation-count>
      {{ 'observation.results.observation' | translate }}
      <laji-observation-count
        [timeout]="30000"
        [query]="searchQuery.query"
        [tick]="searchQuery.tack"
        [field]="'unit.linkings.taxon.speciesId'"
        [overrideInQuery]="{includeNonValidTaxa: false}">
      </laji-observation-count>
      {{ 'observation.results.species' | translate }}
    </strong>
    <strong *ngIf="active === 'finnish'">
      <laji-observation-count
        [timeout]="30000"
        [overrideInQuery]="{countryId: 'ML.206'}"
        [query]="searchQuery.query"
        [tick]="searchQuery.tack"></laji-observation-count>
      {{ 'observation.results.observation' | translate }}
      <laji-observation-count
        [timeout]="30000"
        [overrideInQuery]="{countryId: 'ML.206', includeNonValidTaxa: false}"
        [query]="searchQuery.query"
        [tick]="searchQuery.tack"
        [field]="'unit.linkings.taxon.speciesId'">
      </laji-observation-count>
      {{ 'observation.results.species' | translate }}
    </strong>
  </li>
</ul>

<div class="whole-data-list" *ngIf="['map', 'list', 'images', 'species', 'stats', 'load'].indexOf(active) > -1">
  <ul class="nav nav-tabs nav-justified">
    <li role="presentation" [ngClass]="{active: active === 'map'}">
      <a [routerLink]="'/observation/map' | localize" [queryParams]="queryParams">
        {{ 'search.result.map' | translate }}
      </a>
    </li>
    <li role="presentation" [ngClass]="{active: active === 'list'}">
      <a [routerLink]="'/observation/list' | localize" [queryParams]="queryParams">
        {{ 'search.result.list' | translate }}
      </a>
    </li>
    <li role="presentation" [ngClass]="{active: active === 'images'}">
      <a [routerLink]="'/observation/images' | localize" [queryParams]="queryParams">
        {{ 'search.result.images' | translate }}
      </a>
    </li>
    <li role="presentation" [ngClass]="{active: active === 'species'}">
      <a [routerLink]="'/observation/species' | localize" [queryParams]="queryParams">
        {{ 'search.result.species' | translate }}
      </a>
    </li>
    <li role="presentation" [ngClass]="{active: active === 'stats'}">
      <a [routerLink]="'/observation/stats' | localize" [queryParams]="queryParams">
        {{ 'search.result.stats' | translate }}
      </a>
    </li>
    <li role="presentation" [ngClass]="{active: active === 'load'}">
      <a [routerLink]="'/observation/load' | localize" [queryParams]="queryParams">
        {{ 'search.result.load' | translate }}
      </a>
    </li>
  </ul>
</div>

<div class="results">
  <div [hidden]="active !== 'finnish'" *ngIf="activated['finnish']">
    <laji-main-result [lang]="translate.currentLang" [query]="searchQuery.query" [visible]="active === 'finnish'"></laji-main-result>
  </div>
  <div [hidden]="active !== 'map'" *ngIf="activated['map']">
    <laji-observation-map
            [showItemsWhenLessThan]="2000"
            [opacity]="0.5"
            [tick]="searchQuery.tack"
            [visible]="active === 'map'"
            [height]="500"
            [query]="searchQuery.query"
            [draw]="{rectangle: true, marker: false, polygon: false, polyline: false, circle: false}"
            [legend]="true"
            [initWithWorldMap]="true"
            (create)="pickLocation($event)"
    ></laji-observation-map>
  </div>
  <div [hidden]="active !== 'list'" *ngIf="activated['list']">
    <laji-observation-result-list [visible]="active === 'list'" [query]="searchQuery.query"></laji-observation-result-list>
  </div>
  <div [hidden]="active !== 'species'" *ngIf="activated['species']" class="species-list">
    <div class="row">
      <div class="col-sm-12">
        <laji-observation-table
          [visible]="active === 'species'"
          [pageSize]="100"
          [height]="'calc(80vh - 40px)'"
          [query]="searchQuery.query"
          [showSettingsMenu]="false"
          [showRowAsLink]="false"
          [isAggregate]="true"
          [selected]="['unit.species']"
        ></laji-observation-table>
      </div>
    </div>
  </div>
  <div [hidden]="active !== 'images'" *ngIf="activated['images']" style="min-height: 180px; padding: 0 10px 0 0">
    <laji-gallery
      [showPopover]="true"
      [showViewSwitch]="true"
      [tick]="searchQuery.tack"
      [query]="searchQuery.query">
    </laji-gallery>
  </div>
  <div [hidden]="active !== 'stats'" *ngIf="activated['stats']">
    <div *ngIf="activated['stats']">
      <div class="form-group">
        <div class="col-sm-12" style="height: 300px">
          <laji-observation-chart
            [height]="300"
            [showLegend]="true"
            [visible]="active === 'stats'"
          ></laji-observation-chart>
        </div>
      </div>
      <div class="col-xs-12">
        <div [hidden]="!hasYearData"
             class="panel panel-default"
             laji-panel
             [title]="'taxonomy.observations.yearChart' | translate"
             [open]="true"
             [autoToggle]="true"
        >
          <p class="disclaimer">
            {{ 'taxonomy.observations.yearChart.disclaimer' | translate }}
          </p>
          <laji-taxon-year-graph
            [query]="searchQuery.query"
            (hasData)="hasYearData = $event"
          ></laji-taxon-year-graph>
        </div>
        <div [hidden]="!hasMonthDayData"
             class="panel panel-default"
             laji-panel
             [title]="'taxonomy.observations.monthDayChart' |Â translate"
             [open]="true"
             [autoToggle]="true"
        >
          <laji-taxon-month-day-chart
            [query]="searchQuery.query"
            (hasData)="hasMonthDayData = $event"
          ></laji-taxon-month-day-chart>
        </div>
      </div>
      <div class="form-group spacer">
        <div class="col-lg-12">
          <laji-observation-filters [visible]="active === 'stats'" [query]="searchQuery.query" (queryChange)="filterSelect.emit($event)"></laji-observation-filters>
        </div>
      </div>
    </div>
  </div>
  <div [hidden]="active !== 'load'" *ngIf="activated['load']">
    <laji-observation-download [query]="searchQuery.query"></laji-observation-download>
  </div>
</div>
