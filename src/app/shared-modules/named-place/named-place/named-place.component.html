<div class="container-fluid" style="width: 100%">
  <div id="container">
    <laji-document-form-header *ngIf="formData" [formID]="formId" [onlyNpDescription]="true" class="no-flex"></laji-document-form-header>

    <alert *ngIf="errorMsg" type="danger">{{errorMsg}}</alert>

    <ng-container *ngIf="filterByMunicipality">
      <label>{{'MNP.municipality' | label}}</label>
      <laji-area-select [disabled]="editMode" [field]="areaTypes.Municipality"
      [allOptionEnabled]='true' (select)="updateMunicipalityFilter($event)" [value]='municipality'></laji-area-select>
    </ng-container>
    <div *ngIf="filterByBirdAssociationArea">
      <label [tooltip]="birdAssociationAreaHelp"
             [placement]="'right'"
             [isDisabled]="!formData.namedPlaceOptions || !formData.namedPlaceOptions.birdAssociationAreaHelp">{{'MNP.birdAssociationArea' | label}}
        <span *ngIf="formData.namedPlaceOptions && formData.namedPlaceOptions.birdAssociationAreaHelp" class="label-info laji-form-help-glyph"><strong>?</strong></span>
      </label>
      <laji-area-select [disabled]="editMode" [field]="areaTypes.BirdAssociationArea" (select)="updateBirdAssociationAreaFilter($event)"></laji-area-select>
    </div>
    <div *ngIf='allowCreate && !editMode && namedPlaces' class="choose-label">
      <span>{{'np.chooseLabel' | translate}}</span>
      <button class='btn btn-default' (click)='toEditMode(true)'>{{'np.createNew' | translate}}</button>
    </div>
    <laji-spinner [spinning]="loading" [overlay]="true">
      <div *ngIf="namedPlaces && formData && !errorMsg">
        <div class="row np-row">
          <div [ngClass]="{'col-sm-12 col-md-12 col-lg-6': !editMode}">
            <laji-np-choose [namedPlaces]="namedPlaces"
                            [formData]="formData"
                            [userID]="userID"
                            [visible]="!editMode"
                            [allowCreate]="allowCreate"
                            [zoomToData]="formData.namedPlaceOptions?.zoomToData"
                            [activeNP]="activeNP"
                            (onActivePlaceChange)="onActivePlaceChange($event)"
                            (onCreateButtonClick)="toEditMode(true)"
                            (onTabChange)="onTabChange($event)"
                            [preselectedNPIndex]="preselectedNPIndex"></laji-np-choose>
          </div>
          <div [ngClass]="editMode? 'col-xs-12 nav-margin' : 'col-lg-6 nav-margin'">
            <laji-np-edit [editMode]="editMode"
                          [formId]="formId"
                          [loading]="loading"
                          [prepopulatedNamedPlace]="prepopulatedNamedPlace"
                          [namedPlace]="namedPlace"
                          [formRights]="formRights"
                          [formData]="formData"
                          [allowEdit]="allowEdit"
                          (onReserve)="reserve()"
                          (onRelease)="release()"
                          (onEditButtonClick)="toEditMode(false)"
                          (onEditReady)="toNormalMode($event)"
                          (onError)="setErrorMessage($event)"></laji-np-edit>
          </div>
        </div>
      </div>
    </laji-spinner>
  </div>
</div>

<ng-template #birdAssociationAreaHelp>
  <strong>{{'MNP.birdAssociationArea' | label}}</strong>
  <br>
  {{formData.namedPlaceOptions.birdAssociationAreaHelp}}
</ng-template>
