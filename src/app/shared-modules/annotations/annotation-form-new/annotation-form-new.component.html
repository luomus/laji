<form [hidden]="!visible" *lajiLoggedIn="true" class="annotation-form" #annotationForm="ngForm" (ngSubmit)="saveAnnotation()">
    <!--<alert *ngIf="error" type="danger" [dismissible]="true" (onClose)="closeError()">
      {{ 'haseka.form.error' | translate }}
    </alert>
    <div class="row annotation-unidentifiable" *ngIf="!isEditor && identifying">
      <div class="col-sm-12">
        <label>
          <input
            type="checkbox"
            name="unIdentifyable"
            [(ngModel)]="unIdentifyable"
            [disabled]="!!annotation.opinion ||Â annotation.annotationClass !== emptyAnnotationClass"
          >
          {{ 'MAN.typeUnidentifiable' | label }}
        </label>
      </div>
    </div>-->
    <!--<div class="info-button pull-right toggle-intro" *ngIf="!infoModal">
        <i class="link glyphicon glyphicon-info-sign" (click)="toggleInfo()"></i>
    </div>
    <div class="info alert-info" *ngIf="infoModal">
      <div *ngIf="expert && personRoleAnnotation === 'MMAN.expert'; else basicform">
        <div [innerHtml]="'annotation.info.expert' | translate"></div>
        <div class="close-info" (click)="toggleInfo()">x</div>
      </div>
      <ng-template #basicform>
        <div [innerHtml]="'annotation.info.basic' | translate"></div>
        <div class="close-info" (click)="toggleInfo()">x</div>
      </ng-template>
    </div>-->
    <div class="tags-step-1">
        <div *ngFor="let item of annotationAddadableTags$ | async; let i = index" [ngSwitch]="item.id | toQName" class="tag-value">
            <span *ngIf="showOnlyPositiveNegative(item.id)">
                <div class="delete" *ngIf="annotation.addedTags.length > 0 && annotation.addedTags.indexOf(item.id | toQName) !== -1" (click)="deleteSelected(annotation.addedTags, item.id)">X</div>
                <button *ngSwitchCase="annotationTagsObservation[item.id | toQName].value" class="annotation-marker-new {{ annotationTagsObservation[item.id | toQName].quality }}"
                [ngClass]="{'off': annotation.addedTags.length > 0 && annotation.addedTags.indexOf(item.id | toQName) === -1, 'on': annotation.addedTags.indexOf(item.id | toQName) !== -1 }"  (click)="addToAddTags(item.id);" [disabled]="checkAddTags()">
                    <span>{{ item.name }}</span>
            </button>
            </span>
        </div>
    </div>
    <!--<div class="tags">
        <div class="row add-tags">
            <div class="col-lg-6 col-md-12 col-sm-12">
              <label>{{ 'annotation.addTags' | translate }}</label> 
              <select name="addTags" class="input-sm" (change)="onChangeSelectBox($event, 'added')">
                  <option value="" [selected]="isSelected"> Please choose one </option>
                  <ng-template ngFor let-item [ngForOf]="annotationAddadableTags$ | async">
                     <option *ngIf="showOption(item.id)" value="{{item.id}}" [disabled]="disableTags(item.id | toQName)">
                        {{ item.name }}
                     </option>
                  </ng-template>
                </select>
            </div>
        
            <div class="col-lg-6 col-md-12 col-sm-12 selected-tags">
              <span *ngFor="let selected of annotation.addedTags; let i = index" [ngSwitch]="selected | toQName" class="container-annotation">
                  <div *ngSwitchCase="annotationTagsObservation[selected | toQName].value" class="annotation-marker {{ annotationTagsObservation[selected | toQName].quality }}" >
                      <span class="annotation-star {{ annotationTagsObservation[selected | toQName].quality }}"></span>
                      <span>{{ selected | toQName | label }}</span>
                  </div>
                  <div (click)="deleteSelected(annotation.addedTags, selected)"></div>
              </span>
            </div>
        </div>
        <div class="row removed-tags" *ngIf="expert && personRoleAnnotation == 'MMAN.expert'">
            <div class="col-lg-6 col-md-12 col-sm-12">
                <label>{{ 'annotation.removeTags' | translate }}</label>
                <select name="removeTags" class="input-sm" (change)="onChangeSelectBox($event, 'removed')">
                  <option value="" [selected]="isSelected"> {{ 'annotation.chooseTag' | translate }} </option>
                    <ng-template ngFor let-item [ngForOf]="annotationRemovableTags$ | async | activeTags: annotations">
                          <option *ngIf="showOptionDeleted(item.id | toQName)" value="{{ item.id | toQName}}">
                              {{ item.id | toQName | label }}
                          </option>
                    </ng-template>
                </select>
            </div>
          
            <div class="col-lg-6 col-md-12 col-sm-12 selected-tags" *ngIf="expert && personRoleAnnotation == 'MMAN.expert'">
                <span *ngFor="let selected of annotation.removedTags; let i = index" [ngSwitch]="selected | toQName" class="container-annotation">
                    <div *ngSwitchCase="annotationTagsObservation[selected | toQName].value" class="annotation-marker {{ annotationTagsObservation[selected | toQName].quality }}" >
                        <span class="annotation-star {{ annotationTagsObservation[selected | toQName].quality }}"></span>
                        <span>{{ selected | toQName | label }}</span>
                    </div>
                    <div (click)="deleteSelected(annotation.removedTags, selected)"></div>
                </span>
            </div>
        </div>
    </div>-->
    <div class="row taxon" *ngIf="(!isEditor || personRoleAnnotation===annotationRole.expert) && annotation.addedTags.length >0">
      <div class="col-lg-5 col-md-12 col-sm-12" *ngIf="!isEditor || personRoleAnnotation===annotationRole.expert">
        <label>{{ 'taxonomy.taxonomy' | translate }}</label> 
        <span class="switch-mode" *ngIf="unit.linkings && (unit.linkings.originalTaxon || unit.linkings.taxon)" (click)="copyCurrentTaxon()">{{ 'annotation.copyCurrentTag' | translate }}</span>
        <input #taxon
          [ngClass]="{loading: typeaheadLoading}"
          type="text"
          class="form-control input-sm"
          name="opinion"
          [disabled]="unIdentifyable"
          [required]="expert && personRoleAnnotation===annotationRole.expert && (annotation.addedTags.length > 0)"
          [(ngModel)]="annotation.identification.taxon"
          [typeahead]="taxonAutocomplete"
          [typeaheadOptionsLimit]="20"
          [typeaheadWaitMs]="200"
          [typeaheadMinLength]="3"
          [typeaheadOptionField]="'value'"
          [typeaheadItemTemplate]="taxonItem"
          autocomplete="off"
          autocorrect="off"
        >
        <ng-template #taxonItem let-model="item">
          <h5 class="autosuggest-value {{model.groups}} informal-group-image">
            {{ model.value }}
          </h5>
        </ng-template>
      </div>
  
      <div class="col-lg-2 col-md-3 col-sm-3 text-center">
        <label>{{ 'annotation.coll' | translate }}</label>
        <input type="checkbox" class="form-control input-sm">
      </div>
  
      <div class="col-lg-5 col-md-9 col-sm-12" *ngIf="!isEditor || personRoleAnnotation===annotationRole.expert">
          <label>{{ 'annotation.taxonSpecifier' | translate }}</label>
          <input
          type="text"
          class="form-control input-sm"
          name="taxonSpecifier"
          [disabled]="annotation.identification.taxon===''"
          [(ngModel)]="annotation.identification.taxonSpecifier"
        >
      </div>
    </div>
    <div class="row message" *ngIf="annotation.addedTags.length >0">
      <div class="col-sm-12">
        <label>{{ 'MAN.notes' | label }}</label>
        <textarea #comment
                  name="notes"
                  class="form-control feedback-text input-sm"
                  [required]="(!expert || personRoleAnnotation!==annotationRole.expert) || ((annotation.addedTags.length > 0 && annotation.identification.taxon == '') || annotation.identification.taxon == '')"
                  [(ngModel)]="annotation.notes"></textarea>
      </div>
    </div>
    <div class="actions">
      <!--<button type="button" class="btn btn-danger btn-sm" (click)="cancel.emit()">{{ 'feedback.cancel' | translate }}</button>-->
      <button type="submit" [disabled]="annotationForm.pristine || !annotationForm.form.valid || sending" class="btn btn-success btn-sm">{{ 'annotation.sendAnnotation' | translate }}</button>
    </div>
  </form>
  <div [hidden]="!visible" *lajiLoggedIn="false" class="annotation-form">
    {{ 'force.login' | translate }}
  </div>
  
  
