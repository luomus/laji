<form *lajiLoggedIn="true" class="annotation-form" #annotationForm="ngForm" (ngSubmit)="saveAnnotation()">
  <alert *ngIf="error" type="danger" [dismissible]="true" (onClose)="closeError()">
    {{ 'haseka.form.error' | translate }}
  </alert>
  <div class="row annotation-unidentifiable" *ngIf="!isEditor && identifying">
    <div class="col-sm-12">
      <label>
        <input
          type="checkbox"
          name="unIdentifyable"
          [(ngModel)]="unIdentifyable"
          [disabled]="!!annotation.opinion ||Â annotation.annotationClass !== emptyAnnotationClass"
        >
        {{ 'MAN.typeUnidentifiable' | label }}
      </label>
    </div>
  </div>
  <!--<div class="row annotation-class">
    <div class="col-sm-12">
      {{ 'MAN.annotationClass' | label }}:
      <select [(ngModel)]="annotation.annotationClass"
              [disabled]="unIdentifyable"
              name="annotationClass"
              class="form-control input-sm">
        <option *ngFor="let option of annotationOptions$ | async" [value]="option.id">
          {{ option.value | multiLang }}
        </option>
      </select>
    </div>
  </div>-->
  <div class="tags">
      <div class="row add-tags">
          <div class="col-sm-6">
            <label>Add Tags:</label> 
            <select name="addTags" (change)="onChangeSelectBox($event, 'added')">
                <option value="" [selected]="isSelected"> Please choose one </option>
                <ng-template ngFor let-item [ngForOf]="tags">
                   <option *ngIf="showOption(item.id)" value="{{item.id}}">
                      {{ item.name }}
                   </option>
                </ng-template>
              </select>
          </div>
      
          <div class="col-sm-6 selected-tags">
            <span *ngFor="let selected of selectedOptions; let i = index" [ngSwitch]="selected | toQName" class="container-annotation">
                <div *ngSwitchCase="annotationTagsObservation[selected | toQName].value" class="annotation-marker {{ annotationTagsObservation[selected | toQName].quality }}" >
                    <span class="annotation-star {{ annotationTagsObservation[selected | toQName].quality }}"></span>
                    <span>{{ selected | toQName | label }}</span>
                </div>
                <div (click)="deleteSelected(selectedOptions, selected)"></div>
            </span>
          </div>
      </div>
      <div class="row removed-tags">
          <div class="col-sm-6">
              <label>Remove Tags:</label>
              <select name="removeTags" (change)="onChangeSelectBox($event, 'removed')">
                <option value="" [selected]="isSelected"> Please choose one </option>
                  <ng-template ngFor let-item [ngForOf]="annotations | unique">
                      <ng-template ngFor let-tag [ngForOf]="item.addedTags | toQName">
                        <option *ngIf="showOptionDeleted(tag)" value="{{ tag }}">
                            {{ tag | label }}
                        </option>
                      </ng-template>  
                  </ng-template>
              </select>
          </div>
        
          <div class="col-sm-6 selected-tags">
              <span *ngFor="let selected of deletedOptions; let i = index" [ngSwitch]="selected | toQName" class="container-annotation">
                  <div *ngSwitchCase="annotationTagsObservation[selected | toQName].value" class="annotation-marker {{ annotationTagsObservation[selected | toQName].quality }}" >
                      <span class="annotation-star {{ annotationTagsObservation[selected | toQName].quality }}"></span>
                      <span>{{ selected | toQName | label }}</span>
                  </div>
                  <div (click)="deleteSelected(deletedOptions, selected)"></div>
              </span>
          </div>
      </div>
  </div>
  <div class="row">
    <div class="col-sm-5" *ngIf="!isEditor">
      {{ 'MAN.opinion' | label }}:
      <input
        [ngClass]="{loading: typeaheadLoading}"
        type="text"
        class="form-control input-sm"
        name="opinion"
        [disabled]="unIdentifyable"
        [(ngModel)]="annotation.opinion"
        [typeahead]="taxonAutocomplete"
        [typeaheadOptionsLimit]="20"
        [typeaheadWaitMs]="200"
        [typeaheadMinLength]="3"
        [typeaheadOptionField]="'value'"
        [typeaheadItemTemplate]="taxonItem"
        autocomplete="off"
        autocorrect="off"
      >
      <ng-template #taxonItem let-model="item">
        <h5 class="autosuggest-value {{model.groups}} informal-group-image">
          {{ model.value }}
        </h5>
      </ng-template>
    </div>

    <div class="col-sm-2 text-center">
      Coll
      <input type="checkbox" class="form-control input-sm">
    </div>

    <div class="col-sm-5">
        Taxon specifier
        <input type="text" class="form-control input-sm">
    </div>
  </div>
  <div class="row message">
    <div class="col-sm-12">
      {{ 'MAN.notes' | label }}:
      <textarea #notes="ngModel"
                name="notes"
                [required]="annotation.annotationClass === emptyAnnotationClass && !annotation.opinion && !unIdentifyable"
                class="form-control feedback-text input-sm"
                [(ngModel)]="annotation.notes"></textarea>
    </div>
  </div>
  <div class="actions">
    <button type="button" class="btn btn-danger btn-sm" (click)="cancel.emit()">{{ 'feedback.cancel' | translate }}</button>
    <button type="submit" [disabled]="annotationForm.form.pristine || !annotationForm.form.valid || sending" class="btn btn-success btn-sm">{{ 'feedback.send' | translate }}</button>
  </div>
</form>
<div *lajiLoggedIn="false" class="annotation-form">
  {{ 'force.login' | translate }}
</div>
