<laji-spinner [spinning]="loading" [overlay]="true">
  <div class="container info-card" style="width: auto" *ngIf="taxon">
    <h1 style="margin-left: 25px">
      <laji-taxon-name [taxon]="taxon" [addLink]="false"></laji-taxon-name>
    </h1>
    <div>
      <div class="block">
        <div class="panel panel-default"
             laji-panel
             [title]="'taxonomy.card' | translate"
             [open]="settings['taxon-info']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-info', $event.open)"
        >
          <laji-taxon-info [taxon]="taxon"></laji-taxon-info>
        </div>

        <div *ngIf="hasDescription"
             class="panel panel-default"
             laji-panel
             [title]="'Kuvaukset'"
             [open]="settings['taxon-descriptions']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-descriptions', $event.open)"
        >
          <laji-taxon-descriptions
            [taxonDescription]="taxonDescription"
            [context]="context"
            (descriptionChange)="onDescriptionChange($event)"
          ></laji-taxon-descriptions>
        </div>

        <div *ngIf="taxon.misspelledNames"
             class="panel panel-default"
             laji-panel
             [title]="'Synonyymit'"
             [open]="settings['taxon-synonyms']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-synonyms', $event.open)"
        >
          <laji-taxon-synonyms [taxon]="taxon"></laji-taxon-synonyms>
        </div>

        <div *ngIf="taxon.vernacularName || taxon.alternativeVernacularName || taxon.tradeName"
             class="panel panel-default"
             laji-panel
             [title]="'Muut nimet'"
             [open]="settings['taxon-names']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-names', $event.open)"
        >
          <laji-taxon-names [taxon]="taxon"></laji-taxon-names>
        </div>

        <div *ngIf="taxonConceptId"
             class="panel panel-default"
             laji-panel
             [title]="'taxonomy.taxonConcept' | translate"
             [open]="settings['taxon-concept-info']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-concept-info', $event.open)"
        >
          <laji-taxon-concept-info [taxonId]="taxon.id" [taxonConceptId]="taxonConceptId"></laji-taxon-concept-info>
        </div>
      </div>

      <div class="block">
        <div *ngIf="isFromMasterChecklist"
             class="panel panel-default"
             laji-panel
             [title]="'taxonomy.map' | translate"
             [open]="settings['taxon-map']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-map', $event.open)"
        >
          <p class="disclaimer">
            {{ 'taxonomy.map.disclaimer' | translate }}
          </p>
          <laji-observation-map [color]="'#009900'"
                                [settingsKey]="'taxonMap'"
                                [center]="[64.5, 25.0]"
                                [query]="{taxonId: [taxon.id]}"
                                [height]="300"
                                [draw]="false">
          </laji-observation-map>
        </div>

        <div class="panel panel-default taxon-images"
             laji-panel
             [hidden]="!hasTaxonImages && !hasCollectionImages"
             [title]="'taxonomy.images' | translate"
             [open]="settings['taxon-images']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('taxon-images', $event.open)"
        >
          <ul class="nav nav-tabs">
            <li role="presentation"
                [ngClass]="{active: activeImageTab === 'taxon'}"
                *ngIf="hasTaxonImages">
              <a (click)="setActiveImageTab('taxon')">
                {{ 'taxonomy.images.taxon' | translate }}
              </a>
            </li>
            <li role="presentation"
                [ngClass]="{active: activeImageTab === 'collection'}"
                *ngIf="hasCollectionImages">
              <a (click)="setActiveImageTab('collection')">
                {{ 'taxonomy.images.collection' | translate }}
              </a>
            </li>
          </ul>
          <div [hidden]="activeImageTab !== 'taxon'" *ngIf="hasTaxonImages">
            <laji-image-gallery [modalImages]="taxonImages"></laji-image-gallery>
          </div>
          <div *ngIf="isFromMasterChecklist" [hidden]="activeImageTab !== 'collection' || !hasCollectionImages">
            <laji-gallery
              *ngIf="taxon.species"
              [shortPager]="true"
              (hasData)="onCollectionImagesLoaded($event)"
              [query]="{taxonId: taxon.id, taxonRankId: taxon.taxonRank, superRecordBasis: 'PRESERVED_SPECIMEN', sourceId: 'KE.3'}" [pageSize]="10"
            ></laji-gallery>
          </div>
        </div>

        <div *ngIf="taxon.hasChildren"
             class="panel panel-default"
             laji-panel
             [title]="'taxonomy.speciesPieChartTitle' | translate"
             [open]="settings['species-pie']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('species-pie', $event.open)"
        >
          <laji-species-pie
            [taxonId]="taxon.id"
          ></laji-species-pie>
        </div>

        <div class="panel panel-default"
             laji-panel
             [title]="'taxonomy.browse.title' | translate"
             [open]="settings['browse']?.open !== false"
             [autoToggle]="true"
             (activate)="updateSettings('browse', $event.open)"
        >
          <ul class="br-list">
            <li>
              <a [routerLink]="'/observation/map' | localize" [queryParams]="{target: taxon.id}">
                {{ 'taxonomy.browse' | translate }}
              </a>
            </li>
            <li>
              <a [routerLink]="'/observation/load' | localize" [queryParams]="{target: taxon.id}">
                {{ 'taxonomy.browse.download' | translate }}
              </a>
            </li>
            <li [hidden]="!taxon.hasChildren">
              <a [routerLink]="['/taxon/list'] | localize" [queryParams]="{target: (taxon.id)}">
                {{ 'taxonomy.browse.downloadSpecies' | translate }}
              </a>
            </li>
            <li [hidden]="!taxon.hasChildren">
              <a [routerLink]="['/taxon/list'] | localize" [queryParams]="{target: (taxon.id), onlyFinnish: true}">
                {{ 'taxonomy.browse.downloadSpeciesFinnish' | translate }}
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="container" *ngIf="taxon === false">
    <h1>
      {{ 'taxonomy.notFound' | translate }}
    </h1>
  </div>
</laji-spinner>
