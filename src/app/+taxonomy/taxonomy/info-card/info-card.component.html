<laji-spinner [spinning]="loading" [overlay]="true">
  <div class="info-card-wrapper" *ngIf="taxon">
    <h1 style="margin-left: 25px">
      <laji-taxon-name [taxon]="taxon" [addLink]="false"></laji-taxon-name>
    </h1>
    <div class="panel-container">
      <div class="panel panel-default" laji-panel [title]="'taxonomy.card' | translate" [open]="true" [autoToggle]="true">
        <laji-taxon-info [taxon]="taxon"></laji-taxon-info>
      </div>

      <div *ngIf="taxonConceptId" class="panel panel-default" laji-panel [title]="'taxonomy.taxonConcept' | translate" [open]="true" [autoToggle]="true">
        <laji-taxon-concept-info [taxonId]="taxon.id" [taxonConceptId]="taxonConceptId"></laji-taxon-concept-info>
      </div>

      <div *ngIf="isFromMasterChecklist" class="panel panel-default" laji-panel [title]="'taxonomy.map' | translate" [open]="true" [autoToggle]="true">
        <p class="disclaimer">
          {{ 'taxonomy.map.disclaimer' | translate }}
        </p>
        <laji-observation-map [color]="'#009900'"
                              [settingsKey]="'taxonMap'"
                              [center]="[64.5, 25.0]"
                              [query]="{taxonId: [taxon.id]}"
                              [height]="300"
                              [draw]="false">
        </laji-observation-map>
      </div>

      <div *ngIf="taxon.hasChildren" class="panel panel-default" laji-panel [title]="'taxonomy.speciesPieChartTitle' | translate" [open]="true" [autoToggle]="true">
        <laji-species-pie
          [taxonId]="taxon.id"
        ></laji-species-pie>
      </div>
    </div>
    <!--div class="row">
      <div class="col-md-6 descriptions" *ngIf="hasDescription">
        <select style="margin-bottom: 8px;" class="form-control"
                (change)="onDescriptionChange($event.target.value)"
                *ngIf="taxonDescription.length > 1">
          <option *ngFor="let description of taxonDescription; let i = index"
                  [value]="description.id"
                  [selected]="activeDescription === i">
            {{ description.title ? (description.title | multiLang) : description.id }}
          </option>
        </select>
        <div class="panel-group" role="tablist" aria-multiselectable="true">
          <div class="panel panel-default"
               *ngFor="let group of taxonDescription[activeDescription]?.groups; let i = index"
               [title]="group.title | multiLang"
               [open]="true"
               [index]="i"
               [headerLink]="false"
               laji-panel>
            <div *ngFor="let variable of group.variables">
              <h4 *ngIf="variable.title !== 'Ingressi'">
                {{ variable.title | multiLang }}
              </h4>
              <span [innerHTML]="variable.content | multiLang"></span>
            </div>
          </div>
        </div>
        <ng-container *ngIf="taxonDescription[activeDescription]?.id !== 'default'">
          {{ 'taxonomy.source' | translate }}: {{ taxonDescription[activeDescription]?.title | multiLang }}
        </ng-container>
        <div *ngIf="taxonDescription[activeDescription]?.speciesCardAuthors">
          {{ taxonDescription[activeDescription]?.speciesCardAuthors.title | multiLang }}:
          <span [innerHTML]="taxonDescription[activeDescription]?.speciesCardAuthors.content | multiLang"></span>
        </div>
      </div>
      <div [class.col-md-6]="hasDescription">
        <div [ngClass]="{
                'col-md-6 col-lg-4': !hasDescription
                }"
             [hidden]="!hasTaxonImages && !hasCollectionImages">
          <div class="panel panel-default taxon-images">
            <div class="panel-heading" role="tab">
              <h4 class="panel-title">{{ 'taxonomy.images' | translate }}</h4>
            </div>
            <div class="panel-body">
              <ul class="nav nav-tabs">
                <li role="presentation"
                    [ngClass]="{active: activeImageTab === 'taxon'}"
                    *ngIf="hasTaxonImages">
                  <a (click)="setActiveImageTab('taxon')">
                    {{ 'taxonomy.images.taxon' | translate }}
                  </a>
                </li>
                <li role="presentation"
                    [ngClass]="{active: activeImageTab === 'collection'}"
                    *ngIf="hasCollectionImages">
                  <a (click)="setActiveImageTab('collection')">
                    {{ 'taxonomy.images.collection' | translate }}
                  </a>
                </li>
              </ul>
              <div [hidden]="activeImageTab !== 'taxon'" *ngIf="hasTaxonImages">
                <laji-image-gallery [modalImages]="taxonImages"></laji-image-gallery>
              </div>
              <div *ngIf="isFromMasterChecklist" [hidden]="activeImageTab !== 'collection' || !hasCollectionImages">
                <laji-gallery
                  *ngIf="taxon.species"
                  [shortPager]="true"
                  (hasData)="onCollectionImagesLoaded($event)"
                  [query]="{taxonId: taxon.id, taxonRankId: taxon.taxonRank, superRecordBasis: 'PRESERVED_SPECIMEN', sourceId: 'KE.3'}" [pageSize]="10"></laji-gallery>
              </div>
            </div>
          </div>
        </div>
        <div [ngClass]="{
              'col-md-6': !hasDescription && ((hasCollectionImages || hasTaxonImages) || (!hasCollectionImages && !hasTaxonImages)),
              'col-lg-5': !hasDescription && (hasCollectionImages || hasTaxonImages)
            }">
          <div class="panel panel-default">
            <div class="panel-heading" role="tab">
              <h4 class="panel-title">{{ 'taxonomy.card' | translate }}</h4>
            </div>
            <div class="panel-body">
              <laji-taxon-info [taxon]="taxon"></laji-taxon-info>
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading" role="tab">
              <h4 class="panel-title">{{ 'taxonomy.browse.title' | translate }}</h4>
            </div>
            <div class="panel-body">
              <ul class="br-list">
                <li>
                  <a [routerLink]="'/observation/map' | localize" [queryParams]="{target: taxon.id}">
                    {{ 'taxonomy.browse' | translate }}
                  </a>
                </li>
                <li>
                  <a [routerLink]="'/observation/load' | localize" [queryParams]="{target: taxon.id}">
                    {{ 'taxonomy.browse.download' | translate }}
                  </a>
                </li>
                <li [hidden]="!taxon.hasChildren">
                  <a [routerLink]="['/taxon/list'] | localize" [queryParams]="{target: (taxon.id)}">
                    {{ 'taxonomy.browse.downloadSpecies' | translate }}
                  </a>
                </li>
                <li [hidden]="!taxon.hasChildren">
                  <a [routerLink]="['/taxon/list'] | localize" [queryParams]="{target: (taxon.id), onlyFinnish: true}">
                    {{ 'taxonomy.browse.downloadSpeciesFinnish' | translate }}
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div-->
  </div>
  <div class="container" *ngIf="taxon === false">
    <h1>
      {{ 'taxonomy.notFound' | translate }}
    </h1>
  </div>
</laji-spinner>
