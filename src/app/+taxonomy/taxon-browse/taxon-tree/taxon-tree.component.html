<div id="taxon-tree">
  <div style="position: relative">
    <label>
      {{'species.tree.taxonSearch' | translate}}:
      <input
        [ngClass]="{loading: typeaheadLoading}"
        type="text"
        class="form-control input-sm"
        name="target"
        [(ngModel)]="openTaxon"
        [typeahead]="dataSource"
        [typeaheadOptionsLimit]="typeaheadLimit"
        [typeaheadWaitMs]="200"
        [typeaheadMinLength]="3"
        [typeaheadFocusFirst]="false"
        [typeaheadOptionField]="'value'"
        (typeaheadLoading)="changeTypeaheadLoading($event)"
        (typeaheadOnSelect)="onTaxonSelect($event)"
        (keyup)="onTaxonSelect($event)"
        autocomplete="off"
        autocorrect="off">
    </label>
    <label style="position: absolute; bottom: 0; right: 0">
      <input type="checkbox"
             [(ngModel)]="hideLowerRanks"
             (ngModelChange)="onHideLowerRanksClick()"
             name="hideLowerRanks">
      {{'species.tree.hideLowerRanks' | translate}}
    </label>
  </div>

  <div class="species-table-wrapper">
    <laji-tree-table #treeTable
                     [columns]="columns"
                     [nodes]="nodes"
                     [getChildren]="getChildrenFunc"
                     [getParents]="getParentsFunc"
                     [skipParams]="skipParams"
                     [openId]="openId"
                     (rowSelect)="onRowSelect($event)">
      <ng-template let-value="value" #expanderLabel>
        [{{value.taxonRank | label}}]
      </ng-template>
    </laji-tree-table>
    <div class="setting-menu link" (click)="openSettingsModal()">
      <i class="glyphicon glyphicon-cog"></i>
    </div>
  </div>
</div>

<laji-species-download #speciesDowload
                       [downloadLoading]="downloadLoading"
                       (onDownload)="download($event)">
</laji-species-download>

<laji-species-list-options-modal #settingsModal
                                 (close)="onCloseSettingsModal()"
                                 (settingsLoaded)="onSettingsLoaded()"
                                 [searchQuery]="searchQuery"
                                 [columnLookup]="columnService.columnLookup"
                                 [listType]="'tree'">
</laji-species-list-options-modal>
